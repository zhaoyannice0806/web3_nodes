### ä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨ `uint` æˆ– `int`?

åœ¨ Solidity ä¸­ï¼Œé€‰æ‹© `uint`ï¼ˆæ— ç¬¦å·æ•´æ•°ï¼‰æˆ– `int`ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼‰éœ€åŸºäºæ•°å€¼æ˜¯å¦å¯èƒ½ä¸ºè´Ÿã€‚ä»¥ä¸‹æ˜¯å…·ä½“ä½¿ç”¨åœºæ™¯çš„æ€»ç»“ï¼š


### **ä¸€ã€æ ¸å¿ƒåŒºåˆ«**
| ç±»å‹       | å–å€¼èŒƒå›´                  | å…¸å‹ç”¨é€”                     |
|------------|---------------------------|------------------------------|
| `uint`     | 0 åˆ° 2Â²âµâ¶-1ï¼ˆéè´Ÿæ•°ï¼‰     | æ•°é‡ã€ä½™é¢ã€ç´¢å¼•ã€è®¡æ•°å™¨ç­‰   |
| `int`      | -2Â²âµâµ åˆ° 2Â²âµâµ-1ï¼ˆå¯è´Ÿæ•°ï¼‰ | æ¸©åº¦å˜åŒ–ã€ç›ˆäºè®¡ç®—ç­‰         |


### **äºŒã€æ¨èä½¿ç”¨åœºæ™¯**
#### 1. **ä¼˜å…ˆä½¿ç”¨ `uint` çš„åœºæ™¯**
- **ä»£å¸æ•°é‡**ï¼šå¦‚ ERC-20 çš„ `totalSupply` æˆ– `balanceOf`ï¼Œè´Ÿå€¼æ— æ„ä¹‰ã€‚
- **ç´¢å¼•ä¸è®¡æ•°å™¨**ï¼šå¦‚æ•°ç»„ä¸‹æ ‡ã€å¾ªç¯è®¡æ•°å™¨ï¼ˆå¦‚ `for (uint i = 0; i < 10; i++)`ï¼‰ã€‚
- **é‡‘é¢ä¸æ—¶é—´æˆ³**ï¼šå¦‚æ™ºèƒ½åˆçº¦ä¸­çš„ ETH ä½™é¢ã€åŒºå—æ—¶é—´æˆ³ï¼ˆ`block.timestamp`ï¼‰ã€‚

#### 2. **å¿…é¡»ä½¿ç”¨ `int` çš„åœºæ™¯**
- **å¯èƒ½ä¸ºè´Ÿçš„è®¡ç®—**ï¼šå¦‚æ¸©åº¦å˜åŒ–ï¼ˆ`int temperatureDelta = newTemp - oldTemp`ï¼‰ã€‚
- **é‡‘èç›ˆäº**ï¼šå¦‚è´¦æˆ·çš„åˆ©æ¶¦ï¼ˆ`int profit = revenue - expenses`ï¼‰ã€‚
- **æ•°å­¦è¿ç®—ä¾èµ–è´Ÿæ•°**ï¼šå¦‚ç§‘å­¦è®¡ç®—ä¸­çš„å‘é‡ä½ç§»ã€‚


### **ä¸‰ã€å®‰å…¨è€ƒè™‘**
1. **é¿å…æº¢å‡º/ä¸‹æº¢**ï¼š
   - Solidity 0.8.0+ é»˜è®¤æ£€æŸ¥æº¢å‡ºï¼Œè¶…å‡ºèŒƒå›´ä¼šè§¦å‘ `Panic` å¼‚å¸¸ã€‚
   - æ—§ç‰ˆæœ¬éœ€æ‰‹åŠ¨ä½¿ç”¨ `SafeMath` åº“æˆ–æ˜¾å¼æ£€æŸ¥ï¼ˆå¦‚ `require(a + b >= a)`ï¼‰ã€‚

2. **ç±»å‹åŒ¹é…**ï¼š
   - ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’æ—¶ï¼ˆå¦‚é¢„è¨€æœºï¼‰ï¼Œéœ€ç¡®ä¿è¾“å…¥è¾“å‡ºç±»å‹ä¸€è‡´ã€‚
   - ä¾‹å¦‚ï¼Œé“¾ä¸‹æ¸©åº¦æ•°æ®è‹¥å¯èƒ½ä¸ºè´Ÿï¼Œé“¾ä¸Šåº”ä½¿ç”¨ `int`ã€‚


### **å››ã€ç¤ºä¾‹å¯¹æ¯”**
#### 1. **ä»£å¸åˆçº¦ï¼ˆ`uint`ï¼‰**
```solidity
contract ERC20 {
    uint256 public totalSupply;
    mapping(address => uint256) public balanceOf;

    function transfer(address to, uint256 amount) external {
        require(balanceOf[msg.sender] >= amount, "Insufficient balance");
        balanceOf[msg.sender] -= amount;
        balanceOf[to] += amount;
    }
}
```

#### 2. **æ¸©åº¦é¢„è¨€æœºï¼ˆ`int`ï¼‰**
```solidity
contract TemperatureOracle {
    int256 public currentTemperature;

    function updateTemperature(int256 newTemp) external onlyOwner {
        currentTemperature = newTemp;
    }

    function getTemperatureDelta() external view returns (int256) {
        return currentTemperature - 20; // ä¸åŸºå‡†æ¸©åº¦çš„å·®å€¼
    }
}
```


### **äº”ã€æ€»ç»“**
- **é»˜è®¤ä½¿ç”¨ `uint`**ï¼šé™¤éæ˜ç¡®éœ€è¦å¤„ç†è´Ÿæ•°ï¼Œå¦åˆ™ä¼˜å…ˆé€‰æ‹©æ— ç¬¦å·æ•´æ•°ï¼Œå¯å‡å°‘æº¢å‡ºé£é™©ã€‚
- **æ˜ç¡®å–å€¼èŒƒå›´**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„ä½æ•°ï¼ˆå¦‚ `uint8`ã€`int128`ï¼‰ï¼Œé¿å…æµªè´¹å­˜å‚¨ç©ºé—´ã€‚
- **ç»“åˆå®‰å…¨åº“**ï¼šåœ¨æ—§ç‰ˆæœ¬ Solidity ä¸­ä½¿ç”¨ `SafeMath` é˜²æ­¢æ•°å€¼å¼‚å¸¸ã€‚

- ç­”æ¡ˆï¼š å½“éœ€è¦å­˜å‚¨æ•´æ•°ï¼Œå¦‚æ•°é‡æˆ–ç´¢å¼•æ—¶ï¼Œåº”ä½¿ç”¨ `uint`ï¼ˆæ— ç¬¦å·æ•´æ•°ï¼‰æˆ– `int`ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼‰ã€‚`uint` é€‚ç”¨äºä¸å…è®¸è´Ÿå€¼çš„åœºæ™¯ï¼Œå¦‚æ€»ä¾›åº”é‡ã€‚

```
uint256 public totalSupply;
int256 public balance;
```

### å¦‚ä½•é€‰æ‹©å­˜å‚¨ä»¥å¤ªåŠåœ°å€ä½¿ç”¨çš„æ•°æ®ç»“æ„ï¼Ÿ

åœ¨ Solidity ä¸­é€‰æ‹©å­˜å‚¨ä»¥å¤ªåŠåœ°å€çš„æ•°æ®ç»“æ„ï¼Œéœ€æ ¹æ®**è®¿é—®é¢‘ç‡ã€æ•°æ®å…³è”æ€§ã€è¿­ä»£éœ€æ±‚åŠ Gas æ•ˆç‡**ç»¼åˆåˆ¤æ–­ã€‚ä»¥ä¸‹æ˜¯ä¸åŒåœºæ™¯çš„æ¨èæ–¹æ¡ˆåŠåŸå› ï¼š

---

### **1. å•ä¸ªåœ°å€ï¼šç›´æ¥ä½¿ç”¨ `address` ç±»å‹**
- **åœºæ™¯**ï¼šå­˜å‚¨ç®¡ç†å‘˜åœ°å€ã€å•ç‚¹æ¥æ”¶åœ°å€
- **ä»£ç ç¤ºä¾‹**ï¼š
  ```solidity
  address public owner;                      // åˆçº¦æ‹¥æœ‰è€…
  address payable public treasury;           // èµ„é‡‘æ¥æ”¶åœ°å€ï¼ˆéœ€è½¬è´¦åŠŸèƒ½ï¼‰
  ```

---

### **2. åœ°å€å­˜åœ¨æ€§æ£€æŸ¥ï¼š`mapping(address => bool)`**
- **åœºæ™¯**ï¼šç™½åå•ã€æƒé™æ§åˆ¶ã€å»é‡æ£€æµ‹
- **ä¼˜åŠ¿**ï¼šO(1) æ—¶é—´å¤æ‚åº¦æŸ¥è¯¢
- **ä»£ç ç¤ºä¾‹**ï¼š
  ```solidity
  mapping(address => bool) public isWhitelisted;
  
  function addToWhitelist(address _user) external {
      isWhitelisted[_user] = true;           // æ·»åŠ åœ°å€åˆ°ç™½åå•
  }
  ```

---

### **3. åœ°å€ä¸å¤æ‚æ•°æ®å…³è”ï¼š`mapping(address => Struct)`**
- **åœºæ™¯**ï¼šç”¨æˆ·èµ„æ–™ã€è´¨æŠ¼æ•°æ®ã€ç»Ÿè®¡ä¿¡æ¯
- **ä»£ç ç¤ºä¾‹**ï¼š
  ```solidity
  struct User {
      uint256 balance;
      uint256 lastActive;
  }
  mapping(address => User) public users;     // åœ°å€æ˜ å°„åˆ°ç”¨æˆ·ç»“æ„ä½“
  ```

---

### **4. éœ€éå†çš„åœ°å€é›†åˆï¼š`EnumerableSet`ï¼ˆOpenZeppelinï¼‰**
- **åœºæ™¯**ï¼šDAO æˆå‘˜åˆ—è¡¨ã€éœ€æ‰¹é‡æ“ä½œçš„åœ°å€æ± 
- **ä¼˜åŠ¿**ï¼šå†…ç½®è¿­ä»£å™¨ï¼Œæ”¯æŒå®‰å…¨éå†
- **ä»£ç ç¤ºä¾‹**ï¼š
  ```solidity
  import "@openzeppelin/contracts/utils/structs/EnumerableSet.sol";
  
  contract DAO {
      using EnumerableSet for EnumerableSet.AddressSet;
      EnumerableSet.AddressSet private members;
  
      function addMember(address _addr) external {
          members.add(_addr);                 // è‡ªåŠ¨å»é‡
      }
  
      function getMemberCount() external view returns (uint256) {
          return members.length();            // è·å–æˆå‘˜æ•°é‡
      }
  }
  ```

---

### **5. éœ€æ’åºçš„åœ°å€ï¼š`è‡ªå®šä¹‰ç»“æ„ä½“ + æ•°ç»„`**
- **åœºæ™¯**ï¼šæŒ‰è´¨æŠ¼é‡æ’åºçš„éªŒè¯è€…ã€æ’è¡Œæ¦œ
- **ä»£ç ç¤ºä¾‹**ï¼š
  ```solidity
  struct Validator {
      address addr;
      uint256 stakedAmount;
  }
  Validator[] public validators;             // å¯æ’åºçš„åœ°å€æ•°ç»„
  
  function addValidator(address _addr, uint256 _amount) external {
      validators.push(Validator(_addr, _amount));
      // æŒ‰è´¨æŠ¼é‡æ’åºï¼ˆéœ€è‡ªè¡Œå®ç°æ’åºé€»è¾‘ï¼‰
  }
  ```

---

### **6. ä¸´æ—¶åœ°å€æ“ä½œï¼š`address[]` åŠ¨æ€æ•°ç»„**
- **åœºæ™¯**ï¼šä¸€æ¬¡æ€§æ‰¹é‡å¤„ç†ï¼ˆéé«˜é¢‘è®¿é—®ï¼‰
- **æ…ç”¨**ï¼šåŠ¨æ€æ•°ç»„éå†çš„ Gas æˆæœ¬éšé•¿åº¦å¢é•¿æ€¥å‰§ä¸Šå‡
- **ä»£ç ç¤ºä¾‹**ï¼š
  ```solidity
  address[] public tempAddresses;
  
  function batchProcess() external {
      for(uint i=0; i<tempAddresses.length; i++) {
          // å¤„ç†æ¯ä¸ªåœ°å€ï¼ˆO(n) å¤æ‚åº¦ï¼‰
      }
      delete tempAddresses;                  // å¤„ç†å®Œæˆåæ¸…ç©º
  }
  ```

---

### **Gas æ•ˆç‡ä¸é€‚ç”¨åœºæ™¯å¯¹æ¯”**
| **æ•°æ®ç»“æ„**                | è¯»å–å¤æ‚åº¦ | å†™å…¥å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯                     | æ¨èåº¦ |
|----------------------------|------------|------------|------------------------------|--------|
| `address` / `address payable` | O(1)       | O(1)       | å•ä¸ªåœ°å€å­˜å‚¨                 | â­â­â­â­ |
| `mapping(address => bool)`   | O(1)       | O(1)       | ç™½åå•ã€æƒé™æ§åˆ¶             | â­â­â­â­ |
| `mapping(address => Struct)` | O(1)       | O(1)       | åœ°å€å…³è”å¤æ‚æ•°æ®             | â­â­â­â­ |
| `EnumerableSet.AddressSet`   | O(1)       | O(1)       | éœ€éå†çš„åœ°å€é›†åˆ             | â­â­â­â­ |
| `Validator[]`ï¼ˆè‡ªå®šä¹‰æ•°ç»„ï¼‰  | O(n)       | O(1)       | æŒ‰æƒé‡æ’åºçš„åœ°å€åˆ—è¡¨         | â­â­   |
| `address[]`ï¼ˆçº¯åŠ¨æ€æ•°ç»„ï¼‰    | O(n)       | O(1)       | ä¸´æ—¶æ‰¹é‡å¤„ç†ï¼ˆéé«˜é¢‘åœºæ™¯ï¼‰    | â­     |

> **å…³é”®å»ºè®®**ï¼š  
> 1. **ä¼˜å…ˆé€‰æ‹©æ˜ å°„ï¼ˆmappingï¼‰**ï¼šé€‚ç”¨äºå¤§å¤šæ•°åœ°å€å­˜å‚¨åœºæ™¯ï¼ŒGas æ•ˆç‡æœ€é«˜ï¼›  
> 2. **é¿å…é•¿æ•°ç»„éå†**ï¼šåŠ¨æ€æ•°ç»„çš„å¾ªç¯æ“ä½œæˆæœ¬æé«˜ï¼Œæ”¹ç”¨ `EnumerableSet` æ›¿ä»£ï¼›  
> 3. **éœ€éå†+é«˜æ•ˆæŸ¥è¯¢æ—¶**ï¼šç»„åˆ `mapping` ä¸ `EnumerableSet`ï¼ˆä¾‹ï¼šç”¨ mapping å­˜å‚¨æ•°æ®ï¼ŒSet å­˜å‚¨é”®ï¼‰ã€‚

---

### **å®‰å…¨å®è·µ**
1. **é›¶åœ°å€æ ¡éªŒ**  
   ```solidity
   function safeTransfer(address to) external {
       require(to != address(0), "Invalid address"); // ç¦æ­¢é›¶åœ°å€
       payable(to).transfer(1 ether);
   }
   ```
2. **åˆçº¦åœ°å€æ£€æŸ¥**ï¼ˆæŒ‰éœ€ï¼‰  
   ```solidity
   require(to.code.length > 0, "Target is not a contract");
   ```
3. **ä½¿ç”¨ `call` æ›¿ä»£ `transfer`**  
   ```solidity
   (bool success, ) = to.call{value: amount}(""); // é¿å… Gas ä¸è¶³é—®é¢˜
   ```

---

### **æ€»ç»“**
- **é«˜é¢‘æŸ¥è¯¢/å†™å…¥**ï¼šç”¨ `mapping(address => ...)`ï¼ˆæœ€é«˜æ•ˆï¼‰  
- **éœ€éå†åœ°å€é›†åˆ**ï¼šç”¨ `EnumerableSet`ï¼ˆé¿å…åŠ¨æ€æ•°ç»„çš„é«˜æˆæœ¬ï¼‰  
- **ç®€å•å•ä¸ªåœ°å€**ï¼šç›´æ¥ `address` æˆ– `address payable`  
- **é›¶åœ°å€é£é™©**ï¼šæ‰€æœ‰å¤–éƒ¨è¾“å…¥åœ°å€å¿…é¡»è¿›è¡Œ `require(_addr != address(0))` æ ¡éªŒ  

> æœ€ç»ˆé€‰æ‹©å–å†³äºä¸šåŠ¡éœ€æ±‚ï¼š  
> - **DeFi ç™½åå•** â†’ `mapping(address => bool)`  
> - **NFT æŒæœ‰äººåˆ—è¡¨** â†’ `EnumerableSet`  
> - **è´¨æŠ¼æ’åºç³»ç»Ÿ** â†’ `Validator[]` æ•°ç»„ + æ’åºé€»è¾‘

- ç­”æ¡ˆï¼š ä½¿ç”¨ `address` æ•°æ®ç±»å‹æ¥å­˜å‚¨ä»¥å¤ªåŠåœ°å€ï¼Œé€‚ç”¨äºç”¨æˆ·é’±åŒ…åœ°å€æˆ–åˆçº¦åœ°å€ã€‚

```
address public owner;
```

### åœ¨ä½•æ—¶ä½¿ç”¨ `string` ä¸ `bytes`?

åœ¨ Solidity ä¸­é€‰æ‹© `string` æˆ– `bytes` ç±»å‹æ—¶ï¼Œéœ€è¦æ ¹æ®**æ•°æ®ç±»å‹æœ¬è´¨ã€æ“ä½œéœ€æ±‚ã€å­˜å‚¨æˆæœ¬**ç»¼åˆå†³ç­–ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å†³ç­–æŒ‡å—ï¼š

---

### **ä¸€ã€æ ¸å¿ƒåŒºåˆ«ä¸å†³ç­–çŸ©é˜µ**
| **ç»´åº¦**       | `string` ç±»å‹                     | `bytes` ç±»å‹                  |
|----------------|----------------------------------|-------------------------------|
| **æœ¬è´¨**       | UTF-8 ç¼–ç çš„åŠ¨æ€é•¿åº¦æ–‡æœ¬          | åŸå§‹å­—èŠ‚åºåˆ—ï¼ˆæ— ç¼–ç è§£é‡Šï¼‰     |
| **é•¿åº¦è·å–**   | éœ€è½¬å­—èŠ‚ï¼š`bytes(str).length`    | ç›´æ¥å±æ€§ï¼š`data.length`      |
| **å†…å®¹ä¿®æ”¹**   | æ— æ³•ç›´æ¥ä¿®æ”¹                       | æ”¯æŒå­—èŠ‚çº§ä¿®æ”¹               |
| **Gas æˆæœ¬**   | è¾ƒé«˜ï¼ˆæ¶‰åŠç¼–ç è½¬æ¢ï¼‰              | è¾ƒä½ï¼ˆç‰¹åˆ«æ˜¯å®šé•¿`bytes32`ï¼‰   |

**å†³ç­–æ ‘**ï¼š  
1. éœ€è¦å­˜å‚¨ **äººç±»å¯è¯»æ–‡æœ¬** â†’ é€‰ `string`  
2. éœ€è¦å­˜å‚¨ **åŸå§‹äºŒè¿›åˆ¶æ•°æ®/IPFSå“ˆå¸Œ** â†’ é€‰ `bytes`  
3. **å›ºå®šé•¿åº¦â‰¤32å­—èŠ‚** â†’ ä¼˜å…ˆ `bytes1`-`bytes32`  
4. **éœ€é«˜æ•ˆæ“ä½œå­—èŠ‚** â†’ é€‰ `bytes`

---

### **äºŒã€ä½¿ç”¨ `string` çš„åœºæ™¯åŠç¤ºä¾‹**
#### 1. **å­˜å‚¨ç”¨æˆ·å¯è¯»æ–‡æœ¬**
```solidity
string public tokenName = "Ether Coin";   // ä»£å¸åç§°
string public description = "This is a DeFi token..."; // æè¿°æ–‡æœ¬
```

#### 2. **å›½é™…åŒ–æˆ–å¤šè¯­è¨€æ”¯æŒ**
```solidity
// æ”¯æŒéASCIIå­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ã€emojiï¼‰
string public welcomeMessage = "æ¬¢è¿ä½¿ç”¨! ğŸ‰";
```

#### 3. **éœ€ä¸å‰ç«¯äº¤äº’çš„æ–‡æœ¬æ•°æ®**
```solidity
function getUserInfo() external view returns (string memory) {
    return string(abi.encodePacked("User:", userName)); // è¿”å›æ‹¼æ¥å­—ç¬¦ä¸²
}
```

---

### **ä¸‰ã€ä½¿ç”¨ `bytes` çš„åœºæ™¯åŠç¤ºä¾‹**
#### 1. **å­˜å‚¨å›ºå®šé•¿åº¦æ•°æ®ï¼ˆä¼˜é€‰`bytesN`ï¼‰**
```solidity
bytes32 public merkleRoot;           // é»˜å…‹å°”æ ‘æ ¹å“ˆå¸Œ
bytes20 public contractAddress;      // åˆçº¦åœ°å€ï¼ˆ20å­—èŠ‚ï¼‰
bytes4 public functionSelector;     // å‡½æ•°é€‰æ‹©å™¨
```

#### 2. **åŸå§‹äºŒè¿›åˆ¶æ•°æ®æ“ä½œ**
```solidity
bytes public rawData; 

// ä¿®æ”¹ç‰¹å®šå­—èŠ‚ä½ç½®
function updateByte(uint index, byte newByte) external {
    rawData[index] = newByte;    // æ”¯æŒç›´æ¥å­—èŠ‚ä¿®æ”¹
}
```

#### 3. **é«˜æ•ˆå­˜å‚¨çŸ­æ–‡æœ¬ï¼ˆGasä¼˜åŒ–ï¼‰**
```solidity
// å°†çŸ­æ–‡æœ¬å­˜å‚¨ä¸º bytes32 èŠ‚çœ Gas
bytes32 public constant SYMBOL = "ETH"; 

function getSymbol() external pure returns (string memory) {
    return string(abi.encodePacked(SYMBOL)); // æŒ‰éœ€è½¬æ¢ä¸ºå­—ç¬¦ä¸²
}
```

---

### **å››ã€å…³é”®å¯¹æ¯”ä¸ Gas ä¼˜åŒ–ç­–ç•¥**
#### å­˜å‚¨æˆæœ¬å¯¹æ¯”ï¼ˆç¤ºä¾‹ï¼‰
| **æ•°æ®ç±»å‹**    | å€¼             | Gas æ¶ˆè€— |
|----------------|----------------|----------|
| `string`       | "Hello World" | 35,000   |
| `bytes`        | "Hello World" | 34,200   |
| `bytes32`      | "Hello World" | 22,100   |

#### ä¼˜åŒ–ç­–ç•¥ï¼š
1. **é•¿åº¦â‰¤32å­—èŠ‚** â†’ ç”¨ `bytes32` æ›¿ä»£ `string`  
   ```solidity
   bytes32 public shortText; // æ¯” string èŠ‚çœ 30% Gas
   ```
2. **é•¿æ–‡æœ¬å­˜å‚¨é“¾ä¸‹**  
   å°†å¤§æ–‡æœ¬å­˜å…¥ IPFS/Arweaveï¼Œé“¾ä¸Šä»…å­˜å“ˆå¸Œï¼š
   ```solidity
   string public ipfsCID = "QmXyZ..."; // é“¾ä¸Šå­˜CID
   ```

---

### **äº”ã€ç±»å‹è½¬æ¢å®è·µ**
#### 1. `string` â†’ `bytes`
```solidity
string memory str = "text";
bytes memory b = bytes(str);       // è½¬ä¸ºå¯å˜é•¿åº¦ bytes
```

#### 2. `bytes` â†’ `string`
```solidity
bytes memory b = hex"74657874";   // "text" çš„å­—èŠ‚å½¢å¼
string memory str = string(b);     // å­—èŠ‚è½¬å­—ç¬¦ä¸²
```

#### 3. `bytes32` â†” `string`
```solidity
// bytes32è½¬å­—ç¬¦ä¸²
bytes32 data = "ETH";
string memory str = string(abi.encodePacked(data));

// å­—ç¬¦ä¸²è½¬bytes32ï¼ˆé•¿åº¦éœ€åŒ¹é…ï¼‰
function stringToBytes32(string memory str) pure returns (bytes32 result) {
    require(bytes(str).length <= 32, "Too long");
    assembly {
        result := mload(add(str, 32))
    }
}
```

---

### **å…­ã€ç‰¹æ®Šåœºæ™¯å¤„ç†**
#### 1. **åŠ¨æ€æ‹¼æ¥å­—ç¬¦ä¸²**
ä¼˜å…ˆç”¨ `abi.encodePacked` å‡å°‘ Gasï¼š
```solidity
function concatenate(string memory a, string memory b) public pure returns (string memory) {
    return string(abi.encodePacked(a, b)); // æ¯”å­—ç¬¦ä¸²æ‹¼æ¥èŠ‚çœGas
}
```

#### 2. **å­˜å‚¨åŠ å¯†æ•°æ®**
```solidity
bytes public encryptedData;  // åŠ å¯†å†…å®¹ï¼ˆæ— ç¼–ç éœ€æ±‚ï¼‰

function decrypt() external view returns (string memory) {
    return string(encryptedData); // ä»…åœ¨éœ€è¦æ—¶è½¬ä¸ºå­—ç¬¦ä¸²
}
```

---

### **æ€»ç»“**
- **`string`**ï¼š  
  ç”¨äº **äººç±»å¯è¯»çš„æ–‡æœ¬**ï¼ˆåç§°ã€æè¿°ï¼‰ï¼Œæ”¯æŒUTF-8ä½†Gasè¾ƒé«˜  
- **`bytes`**ï¼š  
  ç”¨äº **åŸå§‹äºŒè¿›åˆ¶æ•°æ®**ï¼ˆå“ˆå¸Œã€ç¼–ç å†…å®¹ï¼‰ã€**å­—èŠ‚çº§æ“ä½œ**æˆ– **Gasä¼˜åŒ–çŸ­æ–‡æœ¬**  
- **é“å¾‹**ï¼š  
  - é•¿åº¦â‰¤32å­—èŠ‚ â†’ `bytes32`ï¼ˆæœ€å¤§ä¼˜åŒ–ï¼‰  
  - é¿å…é“¾ä¸Šå­˜å‚¨å¤§æ–‡æœ¬ â†’ IPFS+å“ˆå¸Œæ–¹æ¡ˆ  
  - éœ€é¢‘ç¹æ“ä½œæ•°æ® â†’ `bytes`ï¼ˆæ”¯æŒç´¢å¼•ä¿®æ”¹ï¼‰

- ç­”æ¡ˆï¼š å½“å­˜å‚¨å¯å˜é•¿åº¦çš„æ–‡æœ¬æ•°æ®æ—¶ä½¿ç”¨ `string`ï¼›å½“å¤„ç†ä¸éœ€è¦å­—ç¬¦ç¼–ç çš„åŸå§‹å­—èŠ‚æ•°æ®æ—¶ä½¿ç”¨ `bytes`ã€‚

```
string public name;
bytes32 public hash;
```

### æ•°ç»„åœ¨ Solidity ä¸­çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ Solidity ä¸­ï¼Œæ•°ç»„æ˜¯ç®¡ç†æœ‰åºæ•°æ®é›†åˆçš„æ ¸å¿ƒå·¥å…·ï¼Œå…¶åº”ç”¨åœºæ™¯è¦†ç›–åˆçº¦å¼€å‘çš„å¤šä¸ªå…³é”®é¢†åŸŸã€‚ä»¥ä¸‹æ˜¯å…­å¤§å…¸å‹åº”ç”¨åœºæ™¯åŠæœ€ä½³å®è·µï¼š

---

### ä¸€ã€åŠ¨æ€æ•°æ®é›†ç®¡ç†
#### âœ… **åº”ç”¨åœºæ™¯**
- **ä»£å¸ ID é›†åˆï¼ˆNFTï¼‰**  
  å­˜å‚¨ NFT çš„å…¨å±€ ID åˆ—è¡¨ï¼Œæ”¯æŒåŠ¨æ€å¢åˆ 
  ```solidity
  uint256[] public tokenIds;  // [1, 2, 3]
  
  function mint(uint256 _tokenId) external {
      tokenIds.push(_tokenId); // åŠ¨æ€æ·»åŠ æ–°ID
  }
  ```

- **å¤šç­¾é’±åŒ…æˆæƒåœ°å€**  
  ç®¡ç†å¯å‘èµ·äº¤æ˜“çš„åœ°å€åˆ—è¡¨
  ```solidity
  address[] public signers;  // å¤šç­¾æˆå‘˜åœ°å€é›†åˆ
  ```

#### âš ï¸ æ³¨æ„äº‹é¡¹
- **è®¾æœ€å¤§é•¿åº¦é˜²æ”»å‡»**  
  ```solidity
  uint256 constant MAX_SIGNERS = 10;
  function addSigner(address signer) external {
      require(signers.length < MAX_SIGNERS, "Max signers reached");
      signers.push(signer);
  }
  ```

---

### äºŒã€æ‰¹é‡æ“ä½œä¼˜åŒ–
#### âœ… **åº”ç”¨åœºæ™¯**
- **ä»£å¸ç©ºæŠ•**  
  å•äº¤æ˜“å®Œæˆå¤šåœ°å€è½¬è´¦
  ```solidity
  function airdrop(address[] calldata recipients, uint[] calldata amounts) external {
      for(uint i=0; i<recipients.length; i++) {
          _transfer(recipients[i], amounts[i]);
      }
  }
  ```

#### ğŸ”¥ **Gas ä¼˜åŒ–æŠ€å·§**
- ä½¿ç”¨ `calldata` æ›¿ä»£ `memory`  
  ```solidity
  // èŠ‚çœ 22,000+ Gas (çº¦ $0.5 @ 20 Gwei)
  function batchProcess(address[] calldata _users) external { ... }
  ```

---

### ä¸‰ã€æ•°æ®ç´¢å¼•ä¸æŸ¥è¯¢
#### âœ… **åº”ç”¨åœºæ™¯**
- **ç”¨æˆ·ç§¯åˆ†æ’è¡Œæ¦œ**  
  é€šè¿‡ç´¢å¼•å¿«é€Ÿè®¿é—®æ’åºæ•°æ®
  ```solidity
  struct Player {
      address addr;
      uint score;
  }
  Player[] public leaderboard;
  
  function getTopPlayer() external view returns (address) {
      return leaderboard[0].addr; // è·å–ç¬¬ä¸€ååœ°å€
  }
  ```

#### âš¡ **é«˜æ•ˆç´¢å¼•æ–¹æ¡ˆ**
```solidity
mapping(address => uint) public playerIndex; // åœ°å€â†’ç´¢å¼•æ˜ å°„
Player[] public allPlayers;

function addPlayer(address _addr) external {
    playerIndex[_addr] = allPlayers.length;
    allPlayers.push(Player(_addr, 0));
}
```

---

### å››ã€å®ç°å¤æ‚æ•°æ®ç»“æ„
#### âœ… **åº”ç”¨åœºæ™¯**
| ç»“æ„ç±»å‹       | å®ç°æ–¹å¼                     | åº”ç”¨æ¡ˆä¾‹                |
|--------------|----------------------------|------------------------|
| **æ ˆ (LIFO)**  | `push()` + `pop()`          | äº¤æ˜“æ’¤å›é˜Ÿåˆ—            |
| **é˜Ÿåˆ— (FIFO)** | ç¯å½¢ç¼“å†²åŒº                   | é™æµæ“ä½œ               |
| **çŸ©é˜µ**       | åµŒå¥—æ•°ç»„ `uint[][]`         | æ¸¸æˆåœ°å›¾æ•°æ®           |

```solidity
// æ ˆç»“æ„å®ç°
uint256[] stack;

function push(uint value) external {
    stack.push(value);
}

function pop() external returns (uint) {
    return stack.pop();
}
```

---

### äº”ã€å†…å­˜çº§ä¸´æ—¶è®¡ç®—
#### âœ… **åº”ç”¨åœºæ™¯**
- **é“¾ä¸Šæ•°æ®è¿‡æ»¤**  
  ```solidity
  function getActiveUsers() external view returns (address[] memory) {
      address[] memory activeList = new address[](userCount);
      uint count;
      for(uint i=0; i<allUsers.length; i++) {
          if(users[allUsers[i]].isActive) {
              activeList[count++] = allUsers[i];
          }
      }
      return activeList;
  }
  ```

#### ğŸ’¡ ä¼˜åŒ–æŠ€å·§
- ä½¿ç”¨ `memory` æ•°ç»„é¿å…å­˜å‚¨å†™å…¥ï¼ˆèŠ‚çœ 90%+ Gasï¼‰
- æ“ä½œç»“æŸåè‡ªåŠ¨é‡Šæ”¾å†…å­˜

---

### å…­ã€å­˜å‚¨ä¼˜åŒ–å®è·µ
#### âœ… **åº”ç”¨åœºæ™¯**
- **ç»“æ„ä½“ç´§å‡‘å­˜å‚¨**  
  32å­—èŠ‚æ’æ§½å†…æ‰“åŒ…å¤šå­—æ®µ
  ```solidity
  struct PackedData { 
      uint32 id;         // 4å­—èŠ‚
      uint64 timestamp;  // 8å­—èŠ‚
      address owner;     // 20å­—èŠ‚
  } // æ€»è®¡32å­—èŠ‚
  PackedData[] public items; // æ¯ä¸ªæ’æ§½å­˜1ä¸ªç»“æ„ä½“
  ```

#### ğŸ” å‹ç¼©æ•ˆæœå¯¹æ¯”
| å­˜å‚¨æ–¹å¼       | å­—æ®µå ç”¨ | æ’æ§½ä½¿ç”¨é‡ |
|--------------|---------|------------|
| æœªæ‰“åŒ…         | 52å­—èŠ‚  | 3ä¸ªæ’æ§½    |
| **æ‰“åŒ…å**     | **32å­—èŠ‚**| **1ä¸ªæ’æ§½** |

---

### æœ€ä½³å®è·µä¸é¿å‘æŒ‡å—
1. **å®‰å…¨é˜²æŠ¤**
   ```solidity
   // 0.8+ç‰ˆæœ¬è‡ªåŠ¨é˜²æº¢å‡ºï¼Œæ—§ç‰ˆæœ¬éœ€ï¼š
   for (uint i=0; i < arr.length; i++) { ... } // é¿å…i++
   ```

2. **æµ·é‡æ•°æ®å¤„ç†**
   - åˆ†é¡µæŸ¥è¯¢ï¼š`getUsers(uint startIndex, uint limit)`
   - é“¾ä¸‹è®¡ç®—ï¼šä»…å­˜ç»“æœå“ˆå¸Œï¼ˆå¦‚ Merkle Rootï¼‰

3. **å†…å­˜ç®¡ç†**
   ```solidity
   // âœ… æ­£ç¡®ï¼šå‡½æ•°å†…ä¸´æ—¶ä½¿ç”¨memoryæ•°ç»„
   function calculate() pure returns (uint) {
       uint[] memory temp = new uint[](10); 
       ...
   }
   ```

> âš ï¸ **æ…ç”¨åœºæ™¯**ï¼š  
> - é«˜é¢‘å†™å…¥çš„å…¨å±€æ•°ç»„ï¼ˆç”¨æ˜ å°„æ›¿ä»£ï¼‰  
> - éœ€å®æ—¶æ’åºçš„å¤§æ•°æ®é›†ï¼ˆæ”¹ç”¨é“¾ä¸‹ç´¢å¼•ï¼‰

Solidity æ•°ç»„æ˜¯æ„å»ºé“¾ä¸Šæ•°æ®æ¨¡å‹çš„åŸºçŸ³ï¼Œ**æƒè¡¡å­˜å‚¨æˆæœ¬ä¸è®¿é—®æ•ˆç‡**ï¼Œå¯é«˜æ•ˆæ”¯æ’‘ä» DeFi åˆ° GameFi çš„å„ç±»åˆçº¦æ¶æ„ã€‚

- ç­”æ¡ˆï¼š æ•°ç»„ç”¨äºå­˜å‚¨ç›¸åŒç±»å‹çš„å…ƒç´ åˆ—è¡¨ï¼Œé€‚ç”¨äºéœ€è¦å­˜å‚¨å¤šä¸ªå€¼çš„æƒ…å†µï¼Œå¦‚æ•°å­—åˆ—è¡¨æˆ–çŠ¶æ€è®°å½•ã€‚

```
uint256[] public numbers;
```

### ä¸ºä½•ä»¥åŠå¦‚ä½•ä½¿ç”¨ `mapping`?

åœ¨ Solidity ä¸­ï¼Œ`mapping` æ˜¯ä¸€ç§å­˜å‚¨é”®å€¼å¯¹çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œå…¶è®¾è®¡ä¸“ä¸ºåŒºå—é“¾ç¯å¢ƒä¼˜åŒ–ã€‚ä»¥ä¸‹æ˜¯å…³äº `mapping` çš„æ·±åº¦è§£æï¼š


### **ä¸€ã€æ ¸å¿ƒä¼˜åŠ¿ä¸é€‚ç”¨åœºæ™¯**
#### 1. **ä¸ºä½•ä½¿ç”¨ `mapping`ï¼Ÿ**
- **O(1) æ—¶é—´å¤æ‚åº¦**ï¼šæ— è®ºæ•°æ®è§„æ¨¡å¤šå¤§ï¼ŒæŸ¥è¯¢å’Œæ’å…¥æ“ä½œå‡ä¸ºå¸¸æ•°æ—¶é—´ï¼Œè¿œè¶…æ•°ç»„çš„ O(n) æ•ˆç‡ã€‚
- **ç¨€ç–å­˜å‚¨ä¼˜åŒ–**ï¼šä»…å­˜å‚¨å®é™…å­˜åœ¨çš„é”®å€¼å¯¹ï¼Œæœªèµ‹å€¼çš„é”®é»˜è®¤è¿”å›ç±»å‹çš„åˆå§‹å€¼ï¼ˆå¦‚ `0`ã€`false`ï¼‰ï¼ŒèŠ‚çœå¤§é‡å­˜å‚¨ç©ºé—´ã€‚
- **å¤©ç„¶é˜²ç¢°æ’**ï¼šä½¿ç”¨ `keccak256` å“ˆå¸Œè®¡ç®—å­˜å‚¨ä½ç½®ï¼Œé¿å…é”®å†²çªã€‚

#### 2. **å…¸å‹åº”ç”¨åœºæ™¯**
- **ä»£å¸ä½™é¢è¿½è¸ª**ï¼š`mapping(address => uint256) public balanceOf;`
- **æƒé™æ§åˆ¶**ï¼š`mapping(address => bool) public isAdmin;`
- **æ•°æ®ç´¢å¼•**ï¼š`mapping(bytes32 => Data) public idToData;`
- **è®¡æ•°å™¨**ï¼š`mapping(address => uint256) public transactionCount;`


### **äºŒã€è¯­æ³•ä¸åŸºç¡€æ“ä½œ**
#### 1. **å£°æ˜ä¸åˆå§‹åŒ–**
```solidity
mapping(KeyType => ValueType) public myMap;
```
- **KeyType**ï¼šæ”¯æŒæ‰€æœ‰å€¼ç±»å‹ï¼ˆå¦‚ `address`ã€`uint`ã€`bytes32`ï¼‰ï¼Œä¸æ”¯æŒå¼•ç”¨ç±»å‹ï¼ˆå¦‚æ•°ç»„ã€ç»“æ„ä½“ï¼‰ã€‚
- **ValueType**ï¼šå¯ä¸ºä»»æ„ç±»å‹ï¼ŒåŒ…æ‹¬åµŒå¥— `mapping` æˆ–ç»“æ„ä½“ã€‚

#### 2. **è¯»å†™æ“ä½œ**
```solidity
contract Example {
    mapping(address => uint256) public balances;

    function setBalance(address user, uint256 amount) external {
        balances[user] = amount; // å†™å…¥å€¼
    }

    function getBalance(address user) external view returns (uint256) {
        return balances[user]; // è¯»å–å€¼ï¼ˆæœªè®¾ç½®æ—¶è¿”å›0ï¼‰
    }
}
```

#### 3. **åµŒå¥—æ˜ å°„**
```solidity
mapping(address => mapping(uint256 => bool)) public userVotes; // ç”¨æˆ·å¯¹ææ¡ˆçš„æŠ•ç¥¨
mapping(bytes32 => mapping(address => uint256)) public tokenBalances; // å¤šä»£å¸ä½™é¢
```


### **ä¸‰ã€é«˜çº§ç‰¹æ€§**
#### 1. **é»˜è®¤å€¼æœºåˆ¶**
æœªèµ‹å€¼çš„é”®è¿”å›ç±»å‹çš„é»˜è®¤å€¼ï¼š
```solidity
mapping(address => uint256) public amounts;
assert(amounts[address(0)] == 0); // é»˜è®¤å€¼ä¸º0

mapping(address => bool) public isRegistered;
assert(isRegistered[address(0)] == false); // é»˜è®¤å€¼ä¸ºfalse
```

#### 2. **è¿­ä»£è§£å†³æ–¹æ¡ˆ**
`mapping` æœ¬èº«ä¸å¯è¿­ä»£ï¼Œä½†å¯ç»“åˆæ•°ç»„å®ç°ï¼š
```solidity
contract IterableMapping {
    mapping(address => uint256) public balances;
    address[] public allUsers;

    function addUser(address user, uint256 amount) external {
        if (balances[user] == 0) {
            allUsers.push(user); // ä»…æ·»åŠ æ–°ç”¨æˆ·
        }
        balances[user] = amount;
    }

    function getUserCount() external view returns (uint256) {
        return allUsers.length;
    }
}
```


### **å››ã€Gas ä¼˜åŒ–æŠ€å·§**
#### 1. **é¿å…é‡å¤å†™å…¥ç›¸åŒå€¼**
```solidity
// ä½æ•ˆ
function setIfNotSet(address user, uint256 amount) external {
    if (balances[user] != amount) { // å¤šä½™æ£€æŸ¥
        balances[user] = amount;
    }
}

// é«˜æ•ˆï¼ˆç›´æ¥å†™å…¥ï¼ŒGasæˆæœ¬å›ºå®šï¼‰
function setBalance(address user, uint256 amount) external {
    balances[user] = amount;
}
```

#### 2. **æ‰¹é‡æ“ä½œ**
```solidity
function batchSetBalances(address[] calldata users, uint256[] calldata amounts) external {
    require(users.length == amounts.length, "Arrays length mismatch");
    for (uint256 i = 0; i < users.length; i++) {
        balances[users[i]] = amounts[i];
    }
}
```


### **äº”ã€å®‰å…¨æ³¨æ„äº‹é¡¹**
#### 1. **é»˜è®¤å€¼é™·é˜±**
```solidity
mapping(address => uint256) public depositTime;

function claimReward() external {
    // å±é™©ï¼šæœªæ£€æŸ¥æ˜¯å¦å·²å­˜æ¬¾ï¼ˆé»˜è®¤å€¼ä¸º0ï¼‰
    require(block.timestamp - depositTime[msg.sender] > 30 days, "Too early");
    // ...
}
```
**ä¿®å¤**ï¼šä½¿ç”¨è¾…åŠ©æ ‡å¿—ä½ï¼š
```solidity
mapping(address => bool) public hasDeposited;
mapping(address => uint256) public depositTime;

function claimReward() external {
    require(hasDeposited[msg.sender], "No deposit");
    // ...
}
```

#### 2. **åµŒå¥—æ˜ å°„çš„åˆ é™¤**
åˆ é™¤åµŒå¥—æ˜ å°„æ—¶éœ€é€çº§åˆ é™¤ï¼š
```solidity
mapping(address => mapping(uint256 => bool)) public votes;

function resetVote(address user, uint256 proposalId) external {
    delete votes[user][proposalId]; // ä»…åˆ é™¤å†…å±‚å€¼
    // è‹¥éœ€å®Œå…¨åˆ é™¤ï¼Œéœ€é¢å¤–æ£€æŸ¥å¤–å±‚æ˜¯å¦ä¸ºç©º
}
```


### **å…­ã€å¯¹æ¯”å…¶ä»–æ•°æ®ç»“æ„**
| æ•°æ®ç»“æ„       | æŸ¥è¯¢æ•ˆç‡ | æ’å…¥æ•ˆç‡ | æœ‰åºæ€§ | é€‚ç”¨åœºæ™¯                     |
|----------------|----------|----------|--------|------------------------------|
| `mapping`      | O(1)     | O(1)     | æ— åº   | å¿«é€Ÿé”®å€¼æŸ¥æ‰¾                 |
| `array`        | O(n)     | O(1)     | æœ‰åº   | éœ€éå†æˆ–æŒ‰ç´¢å¼•è®¿é—®çš„åœºæ™¯     |
| `struct`       | -        | -        | -      | å°è£…å…³è”æ•°æ®                 |
| `mapping`+`array` | O(1)     | O(1)     | æ··åˆ   | éœ€è¿­ä»£çš„æ˜ å°„ï¼ˆå¦‚ç™½åå•ï¼‰     |


### **ä¸ƒã€æ€»ç»“ï¼šä½•æ—¶ä½¿ç”¨ `mapping`**
1. **å¿«é€ŸæŸ¥æ‰¾**ï¼šå½“éœ€è¦é€šè¿‡é”®å¿«é€Ÿå®šä½å€¼æ—¶ï¼ˆå¦‚ç”¨æˆ·ä½™é¢ã€æƒé™ï¼‰ã€‚
2. **ç¨€ç–æ•°æ®**ï¼šå½“æ•°æ®åˆ†å¸ƒæä¸å‡åŒ€æ—¶ï¼ˆå¦‚ä»…å°‘æ•°åœ°å€æŒæœ‰ä»£å¸ï¼‰ã€‚
3. **å¤§æ•°æ®é‡**ï¼šå½“æ•°æ®è§„æ¨¡ä¸ç¡®å®šä¸”å¯èƒ½å¾ˆå¤§æ—¶ï¼ˆé¿å…æ•°ç»„çš„éå†å¼€é”€ï¼‰ã€‚
4. **é˜²ç¢°æ’**ï¼šå½“éœ€è¦å”¯ä¸€æ ‡è¯†æ—¶ï¼ˆå¦‚ä½¿ç”¨ `bytes32` å“ˆå¸Œä½œä¸ºé”®ï¼‰ã€‚

åˆç†ä½¿ç”¨ `mapping` èƒ½æ˜¾è‘—æå‡åˆçº¦æ€§èƒ½ï¼Œé™ä½ Gas æˆæœ¬ï¼Œæ˜¯ Solidity å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„å·¥å…·ã€‚

- ç­”æ¡ˆï¼š `mapping` ç”¨äºåˆ›å»ºé”®å€¼å¯¹æ˜ å°„ï¼Œå¸¸ç”¨äºå­˜å‚¨å…³è”æ•°æ®ï¼Œå¦‚ç”¨æˆ·çš„ä½™é¢ã€‚å®ƒåœ¨æ•°æ®æŸ¥æ‰¾æ–¹é¢æ›´é«˜æ•ˆã€‚

```
mapping(address => uint256) public balances;
```

### `struct` çš„ç”¨é€”åŠå®ä¾‹?

åœ¨ Solidity ä¸­ï¼Œ`mapping` æ˜¯ä¸€ç§å­˜å‚¨é”®å€¼å¯¹çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œå…¶è®¾è®¡ä¸“ä¸ºåŒºå—é“¾ç¯å¢ƒä¼˜åŒ–ã€‚ä»¥ä¸‹æ˜¯å…³äº `mapping` çš„æ·±åº¦è§£æï¼š


### **ä¸€ã€æ ¸å¿ƒä¼˜åŠ¿ä¸é€‚ç”¨åœºæ™¯**
#### 1. **ä¸ºä½•ä½¿ç”¨ `mapping`ï¼Ÿ**
- **O(1) æ—¶é—´å¤æ‚åº¦**ï¼šæ— è®ºæ•°æ®è§„æ¨¡å¤šå¤§ï¼ŒæŸ¥è¯¢å’Œæ’å…¥æ“ä½œå‡ä¸ºå¸¸æ•°æ—¶é—´ï¼Œè¿œè¶…æ•°ç»„çš„ O(n) æ•ˆç‡ã€‚
- **ç¨€ç–å­˜å‚¨ä¼˜åŒ–**ï¼šä»…å­˜å‚¨å®é™…å­˜åœ¨çš„é”®å€¼å¯¹ï¼Œæœªèµ‹å€¼çš„é”®é»˜è®¤è¿”å›ç±»å‹çš„åˆå§‹å€¼ï¼ˆå¦‚ `0`ã€`false`ï¼‰ï¼ŒèŠ‚çœå¤§é‡å­˜å‚¨ç©ºé—´ã€‚
- **å¤©ç„¶é˜²ç¢°æ’**ï¼šä½¿ç”¨ `keccak256` å“ˆå¸Œè®¡ç®—å­˜å‚¨ä½ç½®ï¼Œé¿å…é”®å†²çªã€‚

#### 2. **å…¸å‹åº”ç”¨åœºæ™¯**
- **ä»£å¸ä½™é¢è¿½è¸ª**ï¼š`mapping(address => uint256) public balanceOf;`
- **æƒé™æ§åˆ¶**ï¼š`mapping(address => bool) public isAdmin;`
- **æ•°æ®ç´¢å¼•**ï¼š`mapping(bytes32 => Data) public idToData;`
- **è®¡æ•°å™¨**ï¼š`mapping(address => uint256) public transactionCount;`


### **äºŒã€è¯­æ³•ä¸åŸºç¡€æ“ä½œ**
#### 1. **å£°æ˜ä¸åˆå§‹åŒ–**
```solidity
mapping(KeyType => ValueType) public myMap;
```
- **KeyType**ï¼šæ”¯æŒæ‰€æœ‰å€¼ç±»å‹ï¼ˆå¦‚ `address`ã€`uint`ã€`bytes32`ï¼‰ï¼Œä¸æ”¯æŒå¼•ç”¨ç±»å‹ï¼ˆå¦‚æ•°ç»„ã€ç»“æ„ä½“ï¼‰ã€‚
- **ValueType**ï¼šå¯ä¸ºä»»æ„ç±»å‹ï¼ŒåŒ…æ‹¬åµŒå¥— `mapping` æˆ–ç»“æ„ä½“ã€‚

#### 2. **è¯»å†™æ“ä½œ**
```solidity
contract Example {
    mapping(address => uint256) public balances;

    function setBalance(address user, uint256 amount) external {
        balances[user] = amount; // å†™å…¥å€¼
    }

    function getBalance(address user) external view returns (uint256) {
        return balances[user]; // è¯»å–å€¼ï¼ˆæœªè®¾ç½®æ—¶è¿”å›0ï¼‰
    }
}
```

#### 3. **åµŒå¥—æ˜ å°„**
```solidity
mapping(address => mapping(uint256 => bool)) public userVotes; // ç”¨æˆ·å¯¹ææ¡ˆçš„æŠ•ç¥¨
mapping(bytes32 => mapping(address => uint256)) public tokenBalances; // å¤šä»£å¸ä½™é¢
```


### **ä¸‰ã€é«˜çº§ç‰¹æ€§**
#### 1. **é»˜è®¤å€¼æœºåˆ¶**
æœªèµ‹å€¼çš„é”®è¿”å›ç±»å‹çš„é»˜è®¤å€¼ï¼š
```solidity
mapping(address => uint256) public amounts;
assert(amounts[address(0)] == 0); // é»˜è®¤å€¼ä¸º0

mapping(address => bool) public isRegistered;
assert(isRegistered[address(0)] == false); // é»˜è®¤å€¼ä¸ºfalse
```

#### 2. **è¿­ä»£è§£å†³æ–¹æ¡ˆ**
`mapping` æœ¬èº«ä¸å¯è¿­ä»£ï¼Œä½†å¯ç»“åˆæ•°ç»„å®ç°ï¼š
```solidity
contract IterableMapping {
    mapping(address => uint256) public balances;
    address[] public allUsers;

    function addUser(address user, uint256 amount) external {
        if (balances[user] == 0) {
            allUsers.push(user); // ä»…æ·»åŠ æ–°ç”¨æˆ·
        }
        balances[user] = amount;
    }

    function getUserCount() external view returns (uint256) {
        return allUsers.length;
    }
}
```


### **å››ã€Gas ä¼˜åŒ–æŠ€å·§**
#### 1. **é¿å…é‡å¤å†™å…¥ç›¸åŒå€¼**
```solidity
// ä½æ•ˆ
function setIfNotSet(address user, uint256 amount) external {
    if (balances[user] != amount) { // å¤šä½™æ£€æŸ¥
        balances[user] = amount;
    }
}

// é«˜æ•ˆï¼ˆç›´æ¥å†™å…¥ï¼ŒGasæˆæœ¬å›ºå®šï¼‰
function setBalance(address user, uint256 amount) external {
    balances[user] = amount;
}
```

#### 2. **æ‰¹é‡æ“ä½œ**
```solidity
function batchSetBalances(address[] calldata users, uint256[] calldata amounts) external {
    require(users.length == amounts.length, "Arrays length mismatch");
    for (uint256 i = 0; i < users.length; i++) {
        balances[users[i]] = amounts[i];
    }
}
```


### **äº”ã€å®‰å…¨æ³¨æ„äº‹é¡¹**
#### 1. **é»˜è®¤å€¼é™·é˜±**
```solidity
mapping(address => uint256) public depositTime;

function claimReward() external {
    // å±é™©ï¼šæœªæ£€æŸ¥æ˜¯å¦å·²å­˜æ¬¾ï¼ˆé»˜è®¤å€¼ä¸º0ï¼‰
    require(block.timestamp - depositTime[msg.sender] > 30 days, "Too early");
    // ...
}
```
**ä¿®å¤**ï¼šä½¿ç”¨è¾…åŠ©æ ‡å¿—ä½ï¼š
```solidity
mapping(address => bool) public hasDeposited;
mapping(address => uint256) public depositTime;

function claimReward() external {
    require(hasDeposited[msg.sender], "No deposit");
    // ...
}
```

#### 2. **åµŒå¥—æ˜ å°„çš„åˆ é™¤**
åˆ é™¤åµŒå¥—æ˜ å°„æ—¶éœ€é€çº§åˆ é™¤ï¼š
```solidity
mapping(address => mapping(uint256 => bool)) public votes;

function resetVote(address user, uint256 proposalId) external {
    delete votes[user][proposalId]; // ä»…åˆ é™¤å†…å±‚å€¼
    // è‹¥éœ€å®Œå…¨åˆ é™¤ï¼Œéœ€é¢å¤–æ£€æŸ¥å¤–å±‚æ˜¯å¦ä¸ºç©º
}
```


### **å…­ã€å¯¹æ¯”å…¶ä»–æ•°æ®ç»“æ„**
| æ•°æ®ç»“æ„       | æŸ¥è¯¢æ•ˆç‡ | æ’å…¥æ•ˆç‡ | æœ‰åºæ€§ | é€‚ç”¨åœºæ™¯                     |
|----------------|----------|----------|--------|------------------------------|
| `mapping`      | O(1)     | O(1)     | æ— åº   | å¿«é€Ÿé”®å€¼æŸ¥æ‰¾                 |
| `array`        | O(n)     | O(1)     | æœ‰åº   | éœ€éå†æˆ–æŒ‰ç´¢å¼•è®¿é—®çš„åœºæ™¯     |
| `struct`       | -        | -        | -      | å°è£…å…³è”æ•°æ®                 |
| `mapping`+`array` | O(1)     | O(1)     | æ··åˆ   | éœ€è¿­ä»£çš„æ˜ å°„ï¼ˆå¦‚ç™½åå•ï¼‰     |


### **ä¸ƒã€æ€»ç»“ï¼šä½•æ—¶ä½¿ç”¨ `mapping`**
1. **å¿«é€ŸæŸ¥æ‰¾**ï¼šå½“éœ€è¦é€šè¿‡é”®å¿«é€Ÿå®šä½å€¼æ—¶ï¼ˆå¦‚ç”¨æˆ·ä½™é¢ã€æƒé™ï¼‰ã€‚
2. **ç¨€ç–æ•°æ®**ï¼šå½“æ•°æ®åˆ†å¸ƒæä¸å‡åŒ€æ—¶ï¼ˆå¦‚ä»…å°‘æ•°åœ°å€æŒæœ‰ä»£å¸ï¼‰ã€‚
3. **å¤§æ•°æ®é‡**ï¼šå½“æ•°æ®è§„æ¨¡ä¸ç¡®å®šä¸”å¯èƒ½å¾ˆå¤§æ—¶ï¼ˆé¿å…æ•°ç»„çš„éå†å¼€é”€ï¼‰ã€‚
4. **é˜²ç¢°æ’**ï¼šå½“éœ€è¦å”¯ä¸€æ ‡è¯†æ—¶ï¼ˆå¦‚ä½¿ç”¨ `bytes32` å“ˆå¸Œä½œä¸ºé”®ï¼‰ã€‚

åˆç†ä½¿ç”¨ `mapping` èƒ½æ˜¾è‘—æå‡åˆçº¦æ€§èƒ½ï¼Œé™ä½ Gas æˆæœ¬ï¼Œæ˜¯ Solidity å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„å·¥å…·ã€‚

- ç­”æ¡ˆï¼š `struct` å…è®¸åˆ›å»ºè‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼ŒåŒ…å«å¤šä¸ªä¸åŒç±»å‹çš„å­—æ®µã€‚é€‚ç”¨äºå¤æ‚æ•°æ®ç»„åˆçš„åœºæ™¯ã€‚

```
struct Person {
    string name;
    uint256 age;
}
```

### ä½•æ—¶ä½¿ç”¨ `enum` ä»¥åŠå…¶å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ Solidity ä¸­ï¼Œ`enum`ï¼ˆæšä¸¾ï¼‰æ˜¯ä¸€ç§ç”¨äºå®šä¹‰å‘½åå¸¸é‡é›†åˆçš„è½»é‡çº§ç±»å‹ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå®‰å…¨æ€§ã€‚ä»¥ä¸‹æ˜¯å…³äº `enum` çš„æ·±åº¦è§£æï¼š


### **ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸è¯­æ³•**
#### 1. **å®šä¹‰æšä¸¾ç±»å‹**
```solidity
enum Status {
    Pending,  // é»˜è®¤ä¸º0
    Active,   // 1
    Inactive, // 2
    Terminated // 3
}
```
- **è‡ªåŠ¨èµ‹å€¼**ï¼šæšä¸¾æˆå‘˜é»˜è®¤ä» 0 å¼€å§‹é€’å¢ã€‚
- **æ˜¾å¼èµ‹å€¼**ï¼šå¯æŒ‡å®šç‰¹å®šå€¼ï¼ˆéœ€ä¸º `uint8` èŒƒå›´ï¼‰ï¼š
  ```solidity
  enum ErrorCode {
      OK = 0,
      NotFound = 404,
      InternalError = 500
  }
  ```

#### 2. **ä½¿ç”¨æšä¸¾å˜é‡**
```solidity
contract Example {
    Status public currentStatus = Status.Active;

    function setStatus(Status _status) external {
        currentStatus = _status;
    }

    function isActive() external view returns (bool) {
        return currentStatus == Status.Active;
    }
}
```


### **äºŒã€ä¸ºä½•ä½¿ç”¨ `enum`ï¼Ÿ**
#### 1. **æå‡ä»£ç å¯è¯»æ€§**
- **é—®é¢˜**ï¼šä½¿ç”¨ `uint8` æˆ– `string` è¡¨ç¤ºçŠ¶æ€æ—¶ï¼Œæ•°å€¼æˆ–å­—ç¬¦ä¸²æœ¬èº«ä¸æºå¸¦è¯­ä¹‰ã€‚
  ```solidity
  // éš¾ä»¥ç†è§£çš„ä»£ç 
  if (status == 1) { ... } // 1ä»£è¡¨ä»€ä¹ˆï¼Ÿ
  
  // æ¸…æ™°çš„ä»£ç 
  if (status == Status.Active) { ... }
  ```

#### 2. **ç±»å‹å®‰å…¨**
- **é™åˆ¶å–å€¼èŒƒå›´**ï¼š`enum` å˜é‡åªèƒ½èµ‹å€¼ä¸ºé¢„å®šä¹‰çš„æˆå‘˜ï¼Œé˜²æ­¢æ— æ•ˆå€¼ã€‚
  ```solidity
  // é”™è¯¯ï¼šæ— æ³•ç¼–è¯‘
  currentStatus = Status(4); // è¶…å‡ºå®šä¹‰èŒƒå›´
  ```

#### 3. **èŠ‚çœ Gas**
- **å­˜å‚¨ä¼˜åŒ–**ï¼š`enum` åœ¨å­˜å‚¨ä¸­å ç”¨æœ€å°ç©ºé—´ï¼ˆå¦‚ 4 ä¸ªæˆå‘˜çš„ `enum` ä»…éœ€ 2 ä½ï¼‰ï¼Œç›¸æ¯” `uint8` æ›´èŠ‚çœ Gasã€‚


### **ä¸‰ã€å…¸å‹åº”ç”¨åœºæ™¯**
#### 1. **åˆçº¦çŠ¶æ€æœº**
```solidity
enum ContractState {
    Deployed,
    Funded,
    Active,
    Closed
}

ContractState public state = ContractState.Deployed;

modifier onlyInState(ContractState _state) {
    require(state == _state, "Invalid state");
    _;
}

function activate() external onlyInState(ContractState.Funded) {
    state = ContractState.Active;
}
```

#### 2. **è®¢å•/äº¤æ˜“çŠ¶æ€**
```solidity
enum OrderStatus {
    Created,
    Paid,
    Shipped,
    Completed,
    Refunded
}

mapping(uint256 => OrderStatus) public orderStatus;

function markShipped(uint256 orderId) external {
    require(orderStatus[orderId] == OrderStatus.Paid, "Order not paid");
    orderStatus[orderId] = OrderStatus.Shipped;
}
```

#### 3. **æƒé™çº§åˆ«**
```solidity
enum Role {
    User,
    Moderator,
    Admin,
    Owner
}

mapping(address => Role) public userRoles;

function grantAdmin(address user) external onlyOwner {
    userRoles[user] = Role.Admin;
}
```


### **å››ã€ä¸å…¶ä»–ç±»å‹çš„å¯¹æ¯”**
| ç±»å‹       | ä¼˜åŠ¿                          | åŠ£åŠ¿                          | é€‚ç”¨åœºæ™¯                     |
|------------|-------------------------------|-------------------------------|------------------------------|
| `enum`     | ç±»å‹å®‰å…¨ã€å¯è¯»æ€§é«˜ã€èŠ‚çœ Gas  | æˆå‘˜æ•°é‡å›ºå®šã€æ— æ³•åŠ¨æ€æ‰©å±•    | çŠ¶æ€æœºã€å›ºå®šé€‰é¡¹é›†åˆ         |
| `uint8`    | çµæ´»ã€å¯åŠ¨æ€æ‰©å±•              | æ— ç±»å‹æ£€æŸ¥ã€å¯è¯»æ€§å·®          | éœ€åŠ¨æ€å¢å‡é€‰é¡¹çš„åœºæ™¯         |
| `string`   | è¯­ä¹‰æ˜ç¡®ã€å¯åŠ¨æ€æ‰©å±•          | å­˜å‚¨å’Œæ¯”è¾ƒæˆæœ¬é«˜ã€æ— ç±»å‹æ£€æŸ¥  | éœ€äººç±»å¯è¯»æ–‡æœ¬çš„é…ç½®é¡¹       |


### **äº”ã€æ³¨æ„äº‹é¡¹**
#### 1. **æˆå‘˜æ•°é‡é™åˆ¶**
- **å­˜å‚¨ä¼˜åŒ–**ï¼šæˆå‘˜æ•° â‰¤ 256 æ—¶ï¼Œ`enum` ä½¿ç”¨æœ€å°ä½æ•°å­˜å‚¨ï¼ˆå¦‚ 3 ä¸ªæˆå‘˜ç”¨ 2 ä½ï¼‰ã€‚
- **é¿å…è¿‡åº¦æ‰©å±•**ï¼šè‹¥æˆå‘˜æ•°è¶…è¿‡ 256ï¼Œä¼šè‡ªåŠ¨å‡çº§ä¸º `uint256`ï¼Œå¢åŠ å­˜å‚¨æˆæœ¬ã€‚

#### 2. **è¿ç§»é£é™©**
- **åˆçº¦å‡çº§**ï¼šæ·»åŠ æˆ–åˆ é™¤ `enum` æˆå‘˜å¯èƒ½å¯¼è‡´å­˜å‚¨å¸ƒå±€å˜åŒ–ï¼Œéœ€è°¨æ…å¤„ç†ã€‚

#### 3. **ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’**
- **ABI è½¬æ¢**ï¼š`enum` åœ¨ ABI ä¸­è¡¨ç°ä¸º `uint8`ï¼Œå¤–éƒ¨è°ƒç”¨éœ€æ³¨æ„ç±»å‹è½¬æ¢ã€‚


### **å…­ã€æœ€ä½³å®è·µ**
1. **å‘½åè§„èŒƒ**ï¼šä½¿ç”¨å•æ•°å½¢å¼ï¼ˆå¦‚ `Status` è€Œé `Statuses`ï¼‰ã€‚
2. **å‰ç½®æ£€æŸ¥**ï¼šåœ¨ä¿®æ”¹ `enum` å˜é‡å‰ï¼ŒéªŒè¯çŠ¶æ€è½¬æ¢çš„åˆæ³•æ€§ã€‚
   ```solidity
   function transitionToActive() external {
       require(
           currentStatus == Status.Pending,
           "Can only transition from Pending to Active"
       );
       currentStatus = Status.Active;
   }
   ```
3. **è¾…åŠ©å‡½æ•°**ï¼šæ·»åŠ è·å–æšä¸¾åç§°çš„çº¯å‡½æ•°ï¼ˆéœ€æ‰‹åŠ¨å®ç°ï¼‰ã€‚
   ```solidity
   function getStatusName() external view returns (string memory) {
       if (currentStatus == Status.Pending) return "Pending";
       if (currentStatus == Status.Active) return "Active";
       // ...
   }
   ```


### **ä¸ƒã€æ€»ç»“ï¼šä½•æ—¶ä½¿ç”¨ `enum`**
1. **å›ºå®šé€‰é¡¹é›†åˆ**ï¼šå½“å€¼çš„èŒƒå›´æ˜¯é¢„å®šä¹‰ä¸”ä¸å˜çš„ï¼ˆå¦‚çŠ¶æ€ã€è§’è‰²ï¼‰ã€‚
2. **ç±»å‹å®‰å…¨éœ€æ±‚**ï¼šéœ€è¦ç¡®ä¿å˜é‡åªèƒ½å–ç‰¹å®šå€¼ï¼Œé˜²æ­¢æ— æ•ˆè¾“å…¥ã€‚
3. **ä»£ç å¯è¯»æ€§**ï¼šé€šè¿‡æœ‰æ„ä¹‰çš„åç§°æ›¿ä»£æ— æ„ä¹‰çš„æ•°å€¼æˆ–å­—ç¬¦ä¸²ã€‚
4. **Gas ä¼˜åŒ–**ï¼šåœ¨å­˜å‚¨å¯†é›†å‹åœºæ™¯ä¸­ï¼Œæ›¿ä»£ `uint8` ä»¥èŠ‚çœç©ºé—´ã€‚

åˆç†ä½¿ç”¨ `enum` èƒ½ä½¿åˆçº¦ä»£ç æ›´å¥å£®ã€æ›´æ˜“ç»´æŠ¤ï¼Œæ˜¯ Solidity å¼€å‘ä¸­çš„é‡è¦å·¥å…·ä¹‹ä¸€ã€‚

- ç­”æ¡ˆï¼š `enum` ç”¨äºå®šä¹‰ä¸€ç»„å‘½åå¸¸é‡ï¼Œé™åˆ¶å˜é‡çš„å–å€¼èŒƒå›´ï¼Œé€‚ç”¨äºæœ‰é™é€‰é¡¹çš„æƒ…å†µã€‚

```
enum Status { Pending, Approved, Rejected }
```

### åœ¨è®¾è®¡åˆçº¦æ—¶å¦‚ä½•è€ƒè™‘å­˜å‚¨å’Œ Gas æˆæœ¬ï¼Ÿ

åœ¨è®¾è®¡ Solidity åˆçº¦æ—¶ï¼Œå­˜å‚¨å’Œ Gas æˆæœ¬æ˜¯æ ¸å¿ƒè€ƒé‡å› ç´ ï¼Œç›´æ¥å½±å“åˆçº¦çš„ç»æµæ€§å’Œå¯ç”¨æ€§ã€‚ä»¥ä¸‹æ˜¯ç³»ç»Ÿæ€§çš„ä¼˜åŒ–ç­–ç•¥ï¼š


### **ä¸€ã€å­˜å‚¨æˆæœ¬ä¼˜åŒ–**
#### 1. **å˜é‡æ‰“åŒ…å­˜å‚¨**
- **EVM å­˜å‚¨è§„åˆ™**ï¼šæ¯ä¸ªå­˜å‚¨æ§½ï¼ˆSlotï¼‰ä¸º 32 å­—èŠ‚ï¼Œç›¸é‚»å˜é‡è‹¥æ€»å¤§å° â‰¤ 32 å­—èŠ‚ä¼šæ‰“åŒ…å­˜å‚¨ã€‚
- **ä¼˜åŒ–æŠ€å·§**ï¼š
  ```solidity
  // ä¸è‰¯è®¾è®¡ï¼ˆå ç”¨3ä¸ªæ§½ï¼‰
  uint8 a;    // 1å­—èŠ‚
  uint256 b;  // 32å­—èŠ‚
  uint8 c;    // 1å­—èŠ‚
  
  // ä¼˜åŒ–è®¾è®¡ï¼ˆå ç”¨2ä¸ªæ§½ï¼‰
  uint256 b;  // 32å­—èŠ‚
  uint8 a;    // 1å­—èŠ‚
  uint8 c;    // 1å­—èŠ‚ï¼ˆä¸aå…±ç”¨ä¸€ä¸ªæ§½ï¼‰
  ```

#### 2. **ä½¿ç”¨ç´§å‡‘æ•°æ®ç±»å‹**
- **æŒ‰éœ€é€‰æ‹©**ï¼šä¼˜å…ˆä½¿ç”¨æ»¡è¶³éœ€æ±‚çš„æœ€å°ç±»å‹ï¼ˆå¦‚ `uint16` ä»£æ›¿ `uint256`ï¼‰ã€‚
- **æšä¸¾ï¼ˆ`enum`ï¼‰**ï¼šæ›¿ä»£ `uint8` è¡¨ç¤ºæœ‰é™çŠ¶æ€é›†åˆï¼ŒèŠ‚çœå­˜å‚¨ã€‚
  ```solidity
  enum Status { Pending, Active, Closed } // æœ€å¤šå ç”¨2ä½
  ```

#### 3. **é¿å…åŠ¨æ€æ•°ç»„å’Œæ˜ å°„çš„è¿‡åº¦ä½¿ç”¨**
- **åŠ¨æ€ç»“æ„æˆæœ¬**ï¼šæ¯æ¬¡æ‰©å±•éœ€é¢å¤–å­˜å‚¨ç®¡ç†å¼€é”€ã€‚
- **æ›¿ä»£æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨å›ºå®šå¤§å°æ•°ç»„ï¼ˆå¦‚ `uint256[100]`ï¼‰ã€‚
  - ç»“åˆæ˜ å°„å’Œè®¡æ•°å™¨ï¼ˆå¦‚ `mapping(uint256 => Data)` + `uint256 count`ï¼‰ã€‚


### **äºŒã€Gas æˆæœ¬ä¼˜åŒ–**
#### 1. **å‡å°‘å­˜å‚¨å†™å…¥**
- **å­˜å‚¨å†™å…¥ vs å†…å­˜æ“ä½œ**ï¼šå­˜å‚¨å†™å…¥ï¼ˆSSTOREï¼‰æ˜¯æœ€æ˜‚è´µçš„æ“ä½œï¼ˆ20000 Gasï¼‰ï¼Œå†…å­˜æ“ä½œï¼ˆMSTOREï¼‰ä»… 3 Gasã€‚
  ```solidity
  // ä½æ•ˆ
  function sum(uint256[] calldata nums) external {
      uint256 total = 0;
      for (uint256 i = 0; i < nums.length; i++) {
          total += nums[i];
          s[i] = total; // ä¸å¿…è¦çš„å­˜å‚¨å†™å…¥
      }
  }
  
  // é«˜æ•ˆ
  function sum(uint256[] calldata nums) external returns (uint256) {
      uint256 total = 0;
      for (uint256 i = 0; i < nums.length; i++) {
          total += nums[i]; // ä»…å†…å­˜æ“ä½œ
      }
      return total;
  }
  ```

#### 2. **ç¼“å­˜å­˜å‚¨å˜é‡**
- **å¤šæ¬¡è®¿é—®åŒä¸€å˜é‡**ï¼šå°†å­˜å‚¨å˜é‡ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼ˆ`memory`ï¼‰ã€‚
  ```solidity
  struct User {
      uint256 balance;
      uint256 lastActive;
  }
  
  mapping(address => User) public users;
  
  function updateUser(address user) external {
      User storage userData = users[user]; // ç¼“å­˜å­˜å‚¨å¼•ç”¨
      userData.balance += 100;
      userData.lastActive = block.timestamp;
  }
  ```

#### 3. **æ‰¹é‡æ“ä½œä»£æ›¿å¤šæ¬¡è°ƒç”¨**
- **å•æ¬¡äº¤æ˜“æ‰§è¡Œå¤šæ“ä½œ**ï¼šå‡å°‘äº¤æ˜“å‘èµ·æˆæœ¬ï¼ˆçº¦ 21000 Gas/æ¬¡ï¼‰ã€‚
  ```solidity
  function batchTransfer(address[] calldata recipients, uint256[] calldata amounts) external {
      require(recipients.length == amounts.length, "Arrays length mismatch");
      for (uint256 i = 0; i < recipients.length; i++) {
          transfer(recipients[i], amounts[i]);
      }
  }
  ```


### **ä¸‰ã€é«˜çº§ä¼˜åŒ–æŠ€å·§**
#### 1. **ä½è¿ç®—ä¸ç»“æ„ä½“æ‰“åŒ…**
- **å¤šçŠ¶æ€æ ‡å¿—ä½**ï¼šä½¿ç”¨ `uint256` ä¸­çš„ä¸åŒä½è¡¨ç¤ºå¤šä¸ªå¸ƒå°”å€¼ã€‚
  ```solidity
  uint256 public flags; // 0b0000...0000
  
  function setFlag(uint256 bitIndex, bool value) external {
      if (value) {
          flags |= (1 << bitIndex); // è®¾ç½®ä½
      } else {
          flags &= ~(1 << bitIndex); // æ¸…é™¤ä½
      }
  }
  
  function getFlag(uint256 bitIndex) external view returns (bool) {
      return (flags & (1 << bitIndex)) != 0; // æ£€æŸ¥ä½
  }
  ```

#### 2. **å»¶è¿Ÿå­˜å‚¨å†™å…¥**
- **ä¸­é—´è®¡ç®—åœ¨å†…å­˜ä¸­å®Œæˆ**ï¼šä»…åœ¨å¿…è¦æ—¶å†™å…¥å­˜å‚¨ã€‚
  ```solidity
  function complexCalculation() external {
      uint256 a = loadFromStorage();
      uint256 b = loadFromStorage();
      uint256 result = a * b / 100; // å†…å­˜è®¡ç®—
      if (result > THRESHOLD) {
          saveToStorage(result); // ä»…åœ¨æ¡ä»¶æ»¡è¶³æ—¶å†™å…¥
      }
  }
  ```

#### 3. **æ˜ å°„ï¼ˆ`mapping`ï¼‰æ›¿ä»£æ•°ç»„**
- **ç¨€ç–æ•°æ®**ï¼šæ˜ å°„çš„æŸ¥è¯¢æ•ˆç‡ä¸º O(1)ï¼Œä¸”ä¸å­˜å‚¨æœªåˆå§‹åŒ–çš„é”®ã€‚
  ```solidity
  // é«˜æ•ˆï¼šä»…å­˜å‚¨å®é™…å­˜åœ¨çš„ç”¨æˆ·
  mapping(address => uint256) public balances;
  
  // ä½æ•ˆï¼šéœ€é¢„å…ˆåˆ†é…ç©ºé—´
  address[] public allUsers;
  uint256[] public userBalances;
  ```


### **å››ã€å­˜å‚¨æ¸…é™¤ä¸é‡ç½®**
- **åˆ é™¤å­˜å‚¨å˜é‡**ï¼šå°†å­˜å‚¨æ§½é‡ç½®ä¸º 0 å¯å›æ”¶ 15000 Gasã€‚
  ```solidity
  function resetUser(address user) external {
      delete users[user]; // æ¸…é™¤æ•´ä¸ªç»“æ„ä½“
  }
  ```

- **éƒ¨åˆ†é‡ç½®**ï¼šä»…ä¿®æ”¹éœ€è¦æ›´æ–°çš„å­—æ®µã€‚
  ```solidity
  function partialReset(address user) external {
      users[user].balance = 0; // ä»…é‡ç½®ä½™é¢
  }
  ```


### **äº”ã€å·¥å…·ä¸åˆ†æ**
1. **Gas åˆ†æå·¥å…·**ï¼š
   - **Hardhat/Truffle**ï¼šå†…ç½® Gas æŠ¥å‘ŠåŠŸèƒ½ã€‚
   - **Solidity ç¼–è¯‘å™¨**ï¼šä½¿ç”¨ `--gas` é€‰é¡¹åˆ†æåˆçº¦å„å‡½æ•° Gas æ¶ˆè€—ã€‚

2. **å­˜å‚¨å¸ƒå±€å¯è§†åŒ–**ï¼š
   - **solc**ï¼šä½¿ç”¨ `--storage-layout` æŸ¥çœ‹å˜é‡å­˜å‚¨ä½ç½®ã€‚
   - **Slither**ï¼šæ£€æµ‹æ½œåœ¨çš„å­˜å‚¨å’Œ Gas ä¼˜åŒ–ç‚¹ã€‚


### **å…­ã€æ³¨æ„äº‹é¡¹**
1. **æƒè¡¡ä¼˜åŒ–ä¸å¯è¯»æ€§**ï¼šè¿‡åº¦ç´§å‡‘çš„ä»£ç å¯èƒ½é™ä½å¯ç»´æŠ¤æ€§ã€‚
2. **é¿å…è¿‡æ—©ä¼˜åŒ–**ï¼šä¼˜å…ˆä¿è¯åŠŸèƒ½æ­£ç¡®æ€§ï¼Œå†è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚
3. **æµ‹è¯•ä¸åŒæ–¹æ¡ˆ**ï¼šç›¸åŒæ“ä½œåœ¨ä¸åŒåœºæ™¯ä¸‹çš„ Gas æˆæœ¬å¯èƒ½ä¸åŒï¼Œéœ€å®é™…æµ‹è¯•éªŒè¯ã€‚


### **ä¸ƒã€æ€»ç»“ï¼šä¼˜åŒ–å†³ç­–æ ‘**
1. **æ˜¯å¦é¢‘ç¹è¯»å†™ï¼Ÿ**  
   - æ˜¯ â†’ ä¼˜å…ˆå‡å°‘å­˜å‚¨æ“ä½œï¼Œä½¿ç”¨å†…å­˜ç¼“å­˜ã€‚  
   - å¦ â†’ è¿›å…¥ä¸‹ä¸€æ­¥ã€‚  

2. **æ•°æ®æ˜¯å¦ç»“æ„åŒ–ï¼Ÿ**  
   - æ˜¯ â†’ ä½¿ç”¨ç»“æ„ä½“æ‰“åŒ…å˜é‡ï¼Œæ³¨æ„å­—æ®µé¡ºåºã€‚  
   - å¦ â†’ è¿›å…¥ä¸‹ä¸€æ­¥ã€‚  

3. **æ•°æ®æ˜¯å¦ç¨€ç–ï¼Ÿ**  
   - æ˜¯ â†’ ä½¿ç”¨æ˜ å°„è€Œéæ•°ç»„ã€‚  
   - å¦ â†’ è€ƒè™‘å›ºå®šå¤§å°æ•°ç»„ã€‚  

4. **æ˜¯å¦å¯æ‰¹é‡å¤„ç†ï¼Ÿ**  
   - æ˜¯ â†’ è®¾è®¡æ‰¹é‡æ“ä½œæ¥å£ï¼Œå‡å°‘äº¤æ˜“æ¬¡æ•°ã€‚  

é€šè¿‡ç³»ç»Ÿæ€§çš„å­˜å‚¨å’Œ Gas ä¼˜åŒ–ï¼Œå¯æ˜¾è‘—é™ä½åˆçº¦ä½¿ç”¨æˆæœ¬ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œåè®®ç«äº‰åŠ›ã€‚

- ç­”æ¡ˆï¼š åº”é€‰æ‹©é«˜æ•ˆçš„æ•°æ®ç»“æ„ä»¥å‡å°‘å­˜å‚¨å’Œæ‰§è¡Œæˆæœ¬ã€‚ä¾‹å¦‚ï¼Œ`mapping` é€šå¸¸æ¯”æ•°ç»„æ›´èŠ‚çœ Gas æˆæœ¬ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§è§„æ¨¡æ•°æ®æŸ¥æ‰¾æ—¶ã€‚

### å¦‚ä½•æ ¹æ®æ•°æ®è®¿é—®æ¨¡å¼é€‰æ‹©æ•°æ®ç»“æ„ï¼Ÿ

åœ¨ Solidity ä¸­é€‰æ‹©æ•°æ®ç»“æ„æ—¶ï¼Œéœ€æ ¹æ®æ•°æ®çš„**è®¿é—®æ¨¡å¼**ï¼ˆè¯»/å†™é¢‘ç‡ã€æŸ¥è¯¢æ–¹å¼ã€éå†éœ€æ±‚ç­‰ï¼‰è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ã€‚ä»¥ä¸‹æ˜¯åŸºäºè®¿é—®æ¨¡å¼çš„é€‰å‹æŒ‡å—ï¼š


### **ä¸€ã€æ•°æ®è®¿é—®æ¨¡å¼åˆ†ç±»**
#### 1. **éšæœºè¯»å†™ï¼ˆRandom Accessï¼‰**
- **åœºæ™¯**ï¼šé€šè¿‡å”¯ä¸€é”®å¿«é€Ÿè¯»å†™æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ä½™é¢æŸ¥è¯¢ï¼‰ã€‚
- **æ ¸å¿ƒéœ€æ±‚**ï¼šO(1) æ—¶é—´å¤æ‚åº¦ã€‚

#### 2. **é¡ºåºéå†ï¼ˆSequential Traversalï¼‰**
- **åœºæ™¯**ï¼šæŒ‰é¡ºåºå¤„ç†æ‰€æœ‰æˆ–éƒ¨åˆ†æ•°æ®ï¼ˆå¦‚æ‰¹é‡ä»»åŠ¡æ‰§è¡Œï¼‰ã€‚
- **æ ¸å¿ƒéœ€æ±‚**ï¼šé«˜æ•ˆéå†ï¼Œé¿å… OutOfGasã€‚

#### 3. **æ’å…¥/åˆ é™¤å¯†é›†ï¼ˆInsertion/Deletion-Heavyï¼‰**
- **åœºæ™¯**ï¼šé¢‘ç¹æ·»åŠ æˆ–åˆ é™¤æ•°æ®ï¼ˆå¦‚åŠ¨æ€ç™½åå•ç®¡ç†ï¼‰ã€‚
- **æ ¸å¿ƒéœ€æ±‚**ï¼šä½æ’å…¥/åˆ é™¤æˆæœ¬ã€‚

#### 4. **å­˜åœ¨æ€§æ£€æŸ¥ï¼ˆMembership Checkï¼‰**
- **åœºæ™¯**ï¼šå¿«é€ŸéªŒè¯å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼ˆå¦‚æƒé™éªŒè¯ï¼‰ã€‚
- **æ ¸å¿ƒéœ€æ±‚**ï¼šO(1) å­˜åœ¨æ€§åˆ¤æ–­ã€‚


### **äºŒã€æ•°æ®ç»“æ„é€‰å‹çŸ©é˜µ**
| è®¿é—®æ¨¡å¼               | æ¨èæ•°æ®ç»“æ„                     | å…¸å‹åº”ç”¨åœºæ™¯                     | å…³é”®ä¼˜åŠ¿               |
|------------------------|----------------------------------|----------------------------------|------------------------|
| éšæœºè¯»å†™               | `mapping`                        | ç”¨æˆ·ä½™é¢ã€é…ç½®å‚æ•°               | O(1) æŸ¥è¯¢ä¸å†™å…¥        |
| é¡ºåºéå†               | å›ºå®šå¤§å°æ•°ç»„ `T[size]`           | æ‰¹é‡ä»»åŠ¡ã€å›ºå®šé•¿åº¦æ•°æ®é›†         | è¿ç»­å†…å­˜è®¿é—®é«˜æ•ˆ       |
| åŠ¨æ€é¡ºåºéå†           | åŠ¨æ€æ•°ç»„ `T[]` + æ˜ å°„è¾…åŠ©        | æ´»åŠ¨åˆ—è¡¨ã€å†å²è®°å½•               | æ”¯æŒåŠ¨æ€æ‰©å±•           |
| æ’å…¥/åˆ é™¤å¯†é›†          | æ˜ å°„ `mapping` + æ ‡è®°åˆ é™¤        | ç™½åå•ã€é»‘åå•                   | é¿å…æ•°ç»„é‡æ’å¼€é”€       |
| å­˜åœ¨æ€§æ£€æŸ¥             | `mapping(address => bool)`       | æƒé™æ§åˆ¶ã€å·²æŠ•ç¥¨éªŒè¯             | O(1) å­˜åœ¨æ€§åˆ¤æ–­        |
| æœ‰åºé›†åˆ               | æ˜ å°„ + æ’åºç®—æ³•ï¼ˆå¤–éƒ¨ç»´æŠ¤ï¼‰      | æŒ‰ä½™é¢æ’åã€æŒ‰æ—¶é—´æ’åº           | æ”¯æŒé«˜æ•ˆæ’åºä¸æŸ¥è¯¢     |
| ç¨€ç–æ•°æ®               | `mapping`                        | ä»£å¸æŒæœ‰è€…ï¼ˆä»…å­˜å‚¨éé›¶ä½™é¢ï¼‰     | ä»…å­˜å‚¨æœ‰æ•ˆæ•°æ®         |


### **ä¸‰ã€å…¸å‹åœºæ™¯ä¸å®ç°**
#### 1. **éšæœºè¯»å†™ï¼šç”¨æˆ·ä½™é¢ç®¡ç†**
```solidity
// é«˜æ•ˆæ–¹æ¡ˆï¼šmapping æä¾› O(1) è¯»å†™
mapping(address => uint256) public balances;

function transfer(address to, uint256 amount) external {
    require(balances[msg.sender] >= amount, "Insufficient balance");
    balances[msg.sender] -= amount;
    balances[to] += amount;
}
```

#### 2. **é¡ºåºéå†ï¼šæ‰¹é‡ä»»åŠ¡å¤„ç†**
```solidity
// é«˜æ•ˆæ–¹æ¡ˆï¼šå›ºå®šå¤§å°æ•°ç»„ + æ¸¸æ ‡
struct Task {
    uint256 id;
    bool completed;
}

Task[100] public tasks; // å›ºå®š100ä¸ªä»»åŠ¡
uint256 public taskCount;

function processTasks(uint256 start, uint256 count) external {
    uint256 end = start + count;
    for (uint256 i = start; i < end && i < taskCount; i++) {
        if (!tasks[i].completed) {
            // å¤„ç†ä»»åŠ¡é€»è¾‘
            tasks[i].completed = true;
        }
    }
}
```

#### 3. **æ’å…¥/åˆ é™¤å¯†é›†ï¼šåŠ¨æ€ç™½åå•**
```solidity
// é«˜æ•ˆæ–¹æ¡ˆï¼šmapping + é€»è¾‘åˆ é™¤
mapping(address => bool) public isWhitelisted;
mapping(address => bool) public isDeleted;
address[] public whitelist;

function addToWhitelist(address addr) external {
    if (!isWhitelisted[addr]) {
        isWhitelisted[addr] = true;
        whitelist.push(addr);
    }
}

function removeFromWhitelist(address addr) external {
    require(isWhitelisted[addr], "Not in whitelist");
    isWhitelisted[addr] = false;
    isDeleted[addr] = true;
    // æ— éœ€ç‰©ç†åˆ é™¤ï¼Œå‡å°‘Gasæ¶ˆè€—
}
```

#### 4. **å­˜åœ¨æ€§æ£€æŸ¥ï¼šæŠ•ç¥¨ç³»ç»Ÿ**
```solidity
// é«˜æ•ˆæ–¹æ¡ˆï¼šmapping æä¾› O(1) å­˜åœ¨æ€§æ£€æŸ¥
mapping(address => bool) public hasVoted;
uint256 public yesVotes;
uint256 public noVotes;

function vote(bool support) external {
    require(!hasVoted[msg.sender], "Already voted");
    hasVoted[msg.sender] = true;
    if (support) {
        yesVotes++;
    } else {
        noVotes++;
    }
}
```


### **å››ã€é«˜çº§ä¼˜åŒ–ç­–ç•¥**
#### 1. **æ··åˆæ•°æ®ç»“æ„**
- **åœºæ™¯**ï¼šåŒæ—¶éœ€è¦éšæœºè®¿é—®å’Œé¡ºåºéå†ã€‚
- **æ–¹æ¡ˆ**ï¼šç»„åˆ `mapping` å’Œæ•°ç»„ï¼Œç»´æŠ¤åŒå‘ç´¢å¼•ã€‚
  ```solidity
  struct User {
      uint256 balance;
      uint256 arrayIndex; // åœ¨æ•°ç»„ä¸­çš„ä½ç½®
  }
  
  mapping(address => User) public users;
  address[] public userList;
  
  function addUser(address user, uint256 balance) external {
      if (users[user].arrayIndex == 0) { // é¿å…é‡å¤æ·»åŠ 
          users[user] = User({
              balance: balance,
              arrayIndex: userList.length
          });
          userList.push(user);
      }
  }
  ```

#### 2. **æ‡’åˆ é™¤ï¼ˆLazy Deletionï¼‰**
- **åœºæ™¯**ï¼šé¢‘ç¹åˆ é™¤æ“ä½œå¯¼è‡´æ•°ç»„é‡æ’å¼€é”€å¤§ã€‚
- **æ–¹æ¡ˆ**ï¼šæ ‡è®°åˆ é™¤è€Œéç‰©ç†åˆ é™¤ï¼Œå®šæœŸæ¸…ç†ã€‚
  ```solidity
  mapping(uint256 => bool) public isItemDeleted;
  Item[] public items;
  
  function deleteItem(uint256 index) external {
      require(index < items.length, "Invalid index");
      isItemDeleted[index] = true;
  }
  
  function cleanup() external {
      // å®šæœŸæ¸…ç†å·²åˆ é™¤é¡¹ï¼Œå‡å°‘æ•°ç»„é•¿åº¦
      uint256 writeIndex = 0;
      for (uint256 i = 0; i < items.length; i++) {
          if (!isItemDeleted[i]) {
              if (i != writeIndex) {
                  items[writeIndex] = items[i];
                  items[writeIndex].index = writeIndex;
              }
              writeIndex++;
          }
      }
      items.length = writeIndex;
  }
  ```


### **äº”ã€æ³¨æ„äº‹é¡¹**
1. **Gas æˆæœ¬æƒè¡¡**ï¼š
   - æ•°ç»„éå†çš„ Gas éšé•¿åº¦çº¿æ€§å¢é•¿ï¼Œéœ€é™åˆ¶å•æ¬¡å¤„ç†é‡ã€‚
   - æ˜ å°„çš„å­˜å‚¨æˆæœ¬é«˜äºæ•°ç»„ï¼Œä½†æŸ¥è¯¢æ•ˆç‡æ˜¾è‘—æ›´é«˜ã€‚

2. **å­˜å‚¨å¸ƒå±€**ï¼š
   - é¢‘ç¹è®¿é—®çš„å˜é‡åº”é¿å…ä¸å…¶ä»–å˜é‡æ‰“åŒ…ï¼ˆå¦‚ `bool` ä¸ `uint256`ï¼‰ã€‚
   - ä½¿ç”¨ `pragma experimental ABIEncoderV2` ä¼˜åŒ–ç»“æ„ä½“è¿”å›ã€‚

3. **å¤–éƒ¨ä¾èµ–**ï¼š
   - è‹¥éœ€å¤æ‚æ•°æ®ç»“æ„ï¼ˆå¦‚æ’åºæ ‘ï¼‰ï¼Œå¯è€ƒè™‘å¼•å…¥æˆç†Ÿåº“ï¼ˆå¦‚ OpenZeppelinï¼‰ã€‚


### **å…­ã€æ€»ç»“ï¼šé€‰å‹å†³ç­–æ ‘**
1. **ä¸»è¦è®¿é—®æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ**  
   - éšæœºè¯»å†™ â†’ `mapping`  
   - é¡ºåºéå† â†’ æ•°ç»„ï¼ˆå›ºå®šæˆ–åŠ¨æ€ï¼‰  
   - å­˜åœ¨æ€§æ£€æŸ¥ â†’ `mapping(address => bool)`  

2. **æ•°æ®è§„æ¨¡æ˜¯å¦åŠ¨æ€å˜åŒ–ï¼Ÿ**  
   - æ˜¯ â†’ åŠ¨æ€æ•°ç»„æˆ–æ˜ å°„ + è®¡æ•°å™¨  
   - å¦ â†’ å›ºå®šå¤§å°æ•°ç»„  

3. **æ˜¯å¦éœ€é«˜æ•ˆåˆ é™¤ï¼Ÿ**  
   - æ˜¯ â†’ æ˜ å°„ + æ‡’åˆ é™¤æ ‡è®°  
   - å¦ â†’ ç›´æ¥ä½¿ç”¨æ•°ç»„æˆ–æ˜ å°„  

4. **æ˜¯å¦éœ€æ’åºï¼Ÿ**  
   - æ˜¯ â†’ æ˜ å°„ + å¤–éƒ¨æ’åºï¼ˆå¦‚é“¾ä¸‹ç»´æŠ¤æ’åºç´¢å¼•ï¼‰  
   - å¦ â†’ åŸºç¡€æ•°æ®ç»“æ„  

é€šè¿‡åŒ¹é…æ•°æ®è®¿é—®æ¨¡å¼ä¸æ•°æ®ç»“æ„ç‰¹æ€§ï¼Œå¯æ˜¾è‘—æå‡åˆçº¦æ€§èƒ½ï¼Œé™ä½ Gas æˆæœ¬ï¼Œé¿å…å¸¸è§çš„æ•ˆç‡ç“¶é¢ˆã€‚

- ç­”æ¡ˆï¼š æ ¹æ®åˆçº¦çš„æ•°æ®è®¿é—®é¢‘ç‡å’Œç±»å‹é€‰æ‹©æ•°æ®ç»“æ„ã€‚é¢‘ç¹å˜åŠ¨çš„æ•°æ®å¯èƒ½æ›´é€‚åˆä½¿ç”¨ `mapping`ï¼Œè€Œé™æ€æ•°æ®æˆ–é¡ºåºè®¿é—®çš„æ•°æ®é€‚åˆä½¿ç”¨æ•°ç»„ã€‚

### åœ¨å¤æ‚åˆçº¦ä¸­é€‰æ‹©æ•°æ®ç»“æ„çš„è€ƒè™‘å› ç´ æœ‰å“ªäº›ï¼Ÿ

- ç­”æ¡ˆï¼š éœ€è¦è¯„ä¼°åˆçº¦çš„åŠŸèƒ½éœ€æ±‚ï¼Œé€‰æ‹©å¯ä»¥æ”¯æŒè¿™äº›åŠŸèƒ½çš„æ•°æ®ç»“æ„ã€‚å¤æ‚åˆçº¦å¯èƒ½éœ€è¦ç»“åˆä½¿ç”¨å¤šç§æ•°æ®ç»“æ„ï¼Œå¦‚ç»“åˆä½¿ç”¨ `struct` å’Œ `mapping`ã€‚

### å¦‚ä½•å†³å®šä½¿ç”¨å›ºå®šé•¿åº¦çš„æ•°ç»„è¿˜æ˜¯åŠ¨æ€æ•°ç»„ï¼Ÿ

- ç­”æ¡ˆï¼š å¦‚æœäº‹å…ˆçŸ¥é“æ•°ç»„çš„æœ€å¤§é•¿åº¦ï¼Œå¹¶ä¸”è¿™ä¸ªé•¿åº¦ä¸ä¼šå˜åŒ–ï¼Œä½¿ç”¨å›ºå®šé•¿åº¦æ•°ç»„å¯ä»¥èŠ‚çœ Gas æˆæœ¬ã€‚å¦‚æœæ•°ç»„é•¿åº¦ä¼šåŠ¨æ€å˜åŒ–ï¼Œåº”é€‰æ‹©åŠ¨æ€æ•°ç»„ã€‚

```
uint256[10] public fixedNumbers;
uint256[] public dynamicNumbers;
```

### åœ¨ Solidity ä¸­ä½¿ç”¨ `mapping` å’Œ `array` çš„ä¸»è¦åŒºåˆ«åŠä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ

- ç­”æ¡ˆï¼š `mapping` ç”¨äºå¿«é€ŸæŸ¥æ‰¾å’Œæ›´æ–°é”®å€¼å¯¹ï¼Œé€‚åˆç”¨äºè´¦æˆ·ä½™é¢ç­‰åœºæ™¯ï¼›è€Œ `array` é€‚ç”¨äºå…ƒç´ é¡ºåºé‡è¦æˆ–éœ€è¦è¿­ä»£å¤„ç†çš„åœºæ™¯ã€‚

```
mapping(address => uint256) public userBalances;
address[] public userList;
```

### å¦‚ä½•åˆ©ç”¨ `struct` åœ¨ Solidity ä¸­æ¨¡æ‹Ÿä¼ ç»Ÿçš„æ•°æ®åº“è¡¨ï¼Ÿ

- ç­”æ¡ˆï¼š å¯ä»¥ä½¿ç”¨ `struct` æ¥å®šä¹‰è¡¨çš„åˆ—ï¼Œç„¶åä½¿ç”¨ `mapping` æˆ–æ•°ç»„æ¥å­˜å‚¨ `struct` å®ä¾‹ï¼Œæ¨¡æ‹Ÿè¡Œçš„æ¦‚å¿µã€‚

```
struct Employee {
    uint256 id;
    string name;
    uint256 departmentId;
}
mapping(uint256 => Employee) public employees;
```

### Solidity ä¸­ `enum` å¦‚ä½•å¸®åŠ©é™ä½é”™è¯¯çš„å‘ç”Ÿï¼Ÿ

- ç­”æ¡ˆï¼š `enum` é™åˆ¶å˜é‡çš„å–å€¼èŒƒå›´ï¼Œå‡å°‘éæ³•å€¼çš„è¾“å…¥ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œé”™è¯¯é¢„é˜²ã€‚

```
enum State { Active, Inactive, Suspended }
```

### ä¸ºä½• `bytes` ç±»å‹æœ‰æ—¶æ¯” `string` æ›´ä¼˜ï¼Ÿ

- ç­”æ¡ˆï¼š å½“å¤„ç†ä¸éœ€è¦å­—ç¬¦å¤„ç†åŠŸèƒ½çš„çº¯äºŒè¿›åˆ¶æ•°æ®æ—¶ï¼Œ`bytes` ç±»å‹æ›´èŠ‚çœç©ºé—´å’Œ Gas æˆæœ¬ï¼Œå› ä¸ºå®ƒä¸æ¶‰åŠ UTF-8 ç¼–ç å¤„ç†ã€‚

```
bytes public rawData;
```

### å¦‚ä½•é€‰æ‹©åœ¨ Solidity ä¸­å­˜å‚¨æ—¶é—´çš„æœ€ä½³æ•°æ®ç»“æ„ï¼Ÿ

- ç­”æ¡ˆï¼š ä½¿ç”¨ `uint256` æ¥å­˜å‚¨æ—¶é—´æˆ³æ˜¯æœ€å¸¸è§çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒå¯ä»¥ç›´æ¥ä¸ Ethereum è™šæ‹Ÿæœºçš„æ—¶é—´å‡½æ•°å…¼å®¹ã€‚

```
uint256 public lastUpdated;
```

### åœ¨ Solidity åˆçº¦ä¸­ï¼Œä½•æ—¶åº”è€ƒè™‘å°†æ•°æ®å°è£…åœ¨ `struct` å†…éƒ¨ï¼Ÿ

- ç­”æ¡ˆï¼š å½“æ•°æ®é¡¹é€»è¾‘ä¸Šå±äºåŒä¸€å®ä½“æˆ–éœ€è¦ä¸€èµ·å¤„ç†æ—¶ï¼Œåº”å°†å®ƒä»¬å°è£…åœ¨ä¸€ä¸ª `struct` å†…éƒ¨ä»¥å¢åŠ å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

```
struct Order {
    uint256 orderId;
    uint256 quantity;
    uint256 price;
    address purchaser;
}
```

### `mapping` ç±»å‹æ˜¯å¦æ”¯æŒè¿­ä»£ï¼Ÿå¦‚æœä¸æ”¯æŒï¼Œå¦‚ä½•è§£å†³ï¼Ÿ

- ç­”æ¡ˆï¼š `mapping` æœ¬èº«ä¸æ”¯æŒè¿­ä»£ã€‚å¦‚æœéœ€è¦è¿­ä»£ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå•ç‹¬çš„æ•°ç»„æ¥å­˜å‚¨æ‰€æœ‰é”®ï¼Œç„¶åé€šè¿‡è¿™äº›é”®æ¥è®¿é—® `mapping`ã€‚

```
mapping(address => uint256) public accounts;
address[] public accountList;
```

### åœ¨è®¾è®¡ä¸€ä¸ªåŒ…å«å¤šç§èµ„äº§ç±»å‹çš„é’±åŒ…åˆçº¦æ—¶ï¼Œåº”ä½¿ç”¨å“ªç§æ•°æ®ç»“æ„ï¼Ÿ

- ç­”æ¡ˆï¼š å¯ä»¥ä½¿ç”¨ `mapping` å°†èµ„äº§ç±»å‹ï¼ˆå¦‚ ERC20 ä»£å¸åœ°å€ï¼‰æ˜ å°„åˆ°å¦ä¸€ä¸ª `mapping`ï¼Œåè€…å°†ç”¨æˆ·åœ°å€æ˜ å°„åˆ°ä½™é¢ã€‚

```
mapping(address => mapping(address => uint256)) public balances;
```

### ä½¿ç”¨ `enum` å®šä¹‰çŠ¶æ€æ—¶ï¼Œåº”å¦‚ä½•å¤„ç†çŠ¶æ€çš„è½¬æ¢é€»è¾‘ï¼Ÿ

- ç­”æ¡ˆï¼š å®šä¹‰çŠ¶æ€è½¬æ¢çš„å‡½æ•°ä¸­åº”åŒ…å«çŠ¶æ€éªŒè¯é€»è¾‘ï¼Œç¡®ä¿åˆçº¦çŠ¶æ€æŒ‰é¢„å®šæµç¨‹è½¬æ¢ã€‚

```
enum Stage { Init, Running, Ended }
Stage public stage = Stage.Init;
function nextStage() public {
    if (stage == Stage.Init) {
        stage = Stage.Running;
    } else if (stage == Stage.Running) {
        stage = Stage.Ended;
    }
}
```
